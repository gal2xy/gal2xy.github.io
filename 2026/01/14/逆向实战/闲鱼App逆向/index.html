

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="gla2xy">
  <meta name="keywords" content="">
  
    <meta name="description" content="请求参数分析1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&amp;#123;  &quot;app&quot;: &quot;com.taobao.idlefish&quot;,  &quot;duration&quot;: &quot;1923ms&quot;,  &amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="某鱼App逆向">
<meta property="og:url" content="http://example.com/2026/01/14/%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98/%E9%97%B2%E9%B1%BCApp%E9%80%86%E5%90%91/index.html">
<meta property="og:site_name" content="gla2xy&#39;s blog">
<meta property="og:description" content="请求参数分析1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&amp;#123;  &quot;app&quot;: &quot;com.taobao.idlefish&quot;,  &quot;duration&quot;: &quot;1923ms&quot;,  &amp;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101630794.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101630321.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101630740.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101631606.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101631785.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101631250.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101631240.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101632003.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101632079.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101632789.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101633665.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101633077.png">
<meta property="og:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101633358.png">
<meta property="article:published_time" content="2026-01-14T12:16:25.000Z">
<meta property="article:modified_time" content="2026-02-10T08:34:21.076Z">
<meta property="article:author" content="gla2xy">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101630794.png">
  
  
  
  <title>某鱼App逆向 - gla2xy&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"y4ByOj1FL3SFodYp7tlkfLna-gzGzoHsz","app_key":"7E1eIfDTBkJaMJkiQI0jToXE","server_url":null,"path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>gal2xy&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="某鱼App逆向"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        gla2xy
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2026-01-14 20:16" pubdate>
          2026年1月14日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          88k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          735 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">某鱼App逆向</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="请求参数分析"><a href="#请求参数分析" class="headerlink" title="请求参数分析"></a>请求参数分析</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;app&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;com.taobao.idlefish&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;duration&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1923ms&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;headers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;x-sgext&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;...&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;umid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;...&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-sign&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;...&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-magic_device&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-nettype&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;WIFI&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-pv&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;6.3&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-nq&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;WIFI&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;EagleEye-UserData&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;...&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;first_open&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-features&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;27&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;channel_2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-app-conf-v&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-mini-wua&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;...&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;content-type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;application/x-www-form-urlencoded;charset\u003dUTF-8&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;Content-Length&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1183&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;oaid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;...&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-t&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1767621947&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;Content-Type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;application/x-www-form-urlencoded;charset\u003dUTF-8&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-bx-version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;6.6.231201.33656539&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;f-refer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mtop&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-nw-retry&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;true&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-extdata&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;openappkey%3DDEFAULT_AUTH&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-ttid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;231200%40fleamarket_android_7.24.50&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-app-ver&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;7.24.50&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-c-traceid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;null17676219472770058131963&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-location&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0%2C0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-umt&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;...&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;a-orange-q&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;appKey\u003d21407387\u0026appVersion\u003d7.24.50\u0026clientAppIndexVersion\u003d1120260105180700565\u0026clientVersionIndexVersion\u003d0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-utdid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;...&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;c-launch-info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3,0,1767621947276,1767621723839,3&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-screen-level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;small&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-appkey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;21407387&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;x-falco-id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;...&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;user-agent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MTOPSDK%2F3.1.1.7+%28Android%3B10%3BGoogle%3BPixel+XL%29+DeviceType%28Phone%29&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;Host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;g-acs.m.goofish.com&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;Accept-Encoding&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;gzip&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;Connection&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Keep-Alive&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;POST&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;HTTP/1.1&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;remoteIp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;203.119.252.50&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;remotePort&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">443</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;sessionId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;23672b55-03e4-45a6-b937-a8463af65b16&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2026-01-05 22:05:49&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://g-acs.m.goofish.com/gw/mtop.taobao.idlemtopsearch.search/1.0/&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th>字段</th>
<th>值</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>x-sgext</td>
<td></td>
<td>变化</td>
</tr>
<tr>
<td>umid</td>
<td></td>
<td>固定</td>
</tr>
<tr>
<td>x-sign</td>
<td></td>
<td>变化</td>
</tr>
<tr>
<td>x-mini-wua</td>
<td></td>
<td>变化</td>
</tr>
<tr>
<td>oaid</td>
<td></td>
<td>固定</td>
</tr>
<tr>
<td>x-t</td>
<td></td>
<td>秒级时间戳</td>
</tr>
<tr>
<td>x-extdata</td>
<td>openappkey%3DDEFAULT_AUTH</td>
<td>固定</td>
</tr>
<tr>
<td>x-ttid</td>
<td>231200%40fleamarket_android_7.24.50</td>
<td>固定</td>
</tr>
<tr>
<td>x-c-traceid</td>
<td></td>
<td>null + 毫秒级时间戳 + 4位数字(当前请求次数?) +131963</td>
</tr>
<tr>
<td>x-location</td>
<td></td>
<td>经纬度</td>
</tr>
<tr>
<td>x-umt</td>
<td></td>
<td>固定</td>
</tr>
<tr>
<td>x-utdid</td>
<td></td>
<td>固定</td>
</tr>
<tr>
<td>c-launch-info</td>
<td>3,0,1767621947276,1767621723839,3</td>
<td>3,0,相比x-c-traceid更早的毫秒级时间戳, app启动还是安装的时间戳?</td>
</tr>
<tr>
<td>x-falco-id</td>
<td></td>
<td>变化</td>
</tr>
<tr>
<td>user-agent</td>
<td></td>
<td>sdk+版本 + 设备信息</td>
</tr>
</tbody></table>
<p>同一次搜索，请求前10个商品的参数</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;abConfigs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&#123;&quot;</span>isEnterResultNative<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-string">&quot;,&quot;</span>isSearchResultNative<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-string">&quot;&#125;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;activeSearch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;apiName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;com.taobao.idlefish.search_implement.protocol.SearchResultReq&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;bizFrom&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;home&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;disableHierarchicalSort&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;extraFilterValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&#123;&quot;</span>divisionList<span class="hljs-string">&quot;:[],&quot;</span>excludeMultiPlacesSellers<span class="hljs-string">&quot;:&quot;</span><span class="hljs-number">0</span><span class="hljs-string">&quot;&#125;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;forceUseInputKeyword&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;forceUseTppRepair&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fromFilter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fromKits&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fromLeaf&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fromShade&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fromSuggest&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;keyword&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;bike&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;mainTab&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;originJson&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;page&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;pageNumber&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;relateResultListLastIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;relateResultPageNumber&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;resultListLastIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;rowsPerPage&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;searchReqFromActivatePagePart&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;searchButton&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;searchReqFromPage&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xyHome&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;searchTabType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;SEARCH_TAB_MAIN&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;shadeBucketNum&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;-1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;smartUIFilter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;suggestBucketNum&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;29&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;supportFlexFilter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>同一次搜索，下拉加载更多</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;abConfigs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&#123;&quot;</span>isEnterResultNative<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-string">&quot;,&quot;</span>isSearchResultNative<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-string">&quot;&#125;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;activeSearch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;apiName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;com.taobao.idlefish.search_implement.protocol.SearchResultReq&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;bizFrom&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;home&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;disableHierarchicalSort&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;extraFilterValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&#123;&quot;</span>divisionList<span class="hljs-string">&quot;:[],&quot;</span>excludeMultiPlacesSellers<span class="hljs-string">&quot;:&quot;</span><span class="hljs-number">0</span><span class="hljs-string">&quot;,&quot;</span>hideExcludeMultiPlacesSellers<span class="hljs-string">&quot;:true&#125;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;forceUseInputKeyword&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;forceUseTppRepair&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fromFilter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fromKits&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fromLeaf&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fromShade&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;fromSuggest&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;keyword&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;bike&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;mainTab&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;originJson&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;page&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;pageNumber&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;relateResultListLastIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;relateResultPageNumber&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;resultListLastIndex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;rowsPerPage&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;searchReqFromActivatePagePart&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;searchButton&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;searchReqFromPage&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xyHome&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;searchTabType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;SEARCH_TAB_MAIN&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;shadeBucketNum&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;-1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;singleControl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;smartUIFilter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;sqiControlFieldsJson&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&#123;&quot;</span>abid<span class="hljs-string">&quot;:&quot;</span><span class="hljs-number">477862</span><span class="hljs-string">&quot;,&quot;</span>aiTipSelected<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>allowMatchActivity<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-string">&quot;,&quot;</span>allowUserTppRepairEmptyRes<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-string">&quot;,&quot;</span>bproDocsFound<span class="hljs-string">&quot;:&quot;</span><span class="hljs-number">0</span><span class="hljs-string">&quot;,&quot;</span>canShowUserSubscribeTips<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>cateIdList<span class="hljs-string">&quot;:[&quot;</span><span class="hljs-number">50023914</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">50023914</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">50025418</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">50025418</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">50025467</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">50025418</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">50025449</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">50112002</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">50025418</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">50023914</span><span class="hljs-string">&quot;],&quot;</span>docNumWhenFirstPage<span class="hljs-string">&quot;:&quot;</span><span class="hljs-number">480000</span><span class="hljs-string">&quot;,&quot;</span>enableNewPubRank<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>fetchItemLabelClient<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-string">&quot;,&quot;</span>filterPersonal<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>forceEraseSearchKeywords<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>forceForbidAdItems<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>forceNotBookInetnt<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>forceOnlyCallYuXiaoPuOrPlayboyItems<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>forceOnlyIdleCoinItems<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>forceSrpFeedsEmpty<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>forceYoupinItems<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>fromMini<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>fromNewPublishPage<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>fromPc<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hasFilterWhenFirstPage<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hasMachRulesWhenFirstPage<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hasNewArrival<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hasSortWhenFirstPage<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hideExcludeMultiPlaces<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-string">&quot;,&quot;</span>hitAdvanceSearchDelete<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitBackgroundMaterial<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitBasePanel<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitChannelSourceFromNavMat<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitFilterPersonalHousePanel<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitFilterPersonalPanel<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitGraphSearchSubscribeCpv<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitLevel1Kfc<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitLevel4Kfc<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitLevel5Kfc<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitLevel6Kfc<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitLevelDealPriceKfc<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitRelatedWordInterfereMat<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitRigorousNewStylePanel<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitSidelineV2<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitToBuyPage<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>hitl2l3SensitiveWordInterfereMat<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>ignoreEmptyAlarm<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>iosCouponsForbid<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>itemIdList<span class="hljs-string">&quot;:[&quot;</span><span class="hljs-number">979733895150</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">990538260383</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">674309903803</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">918085444363</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">977728412088</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">988822438547</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">1003976314409</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">1007872356565</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">837081527647</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">999544611726</span><span class="hljs-string">&quot;],&quot;</span>lessItem<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>machDataBecauseAutoFailover<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>materialFromAds<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>moduleBucketMap<span class="hljs-string">&quot;:&#123;&#125;,&quot;</span>myFollowChannelCallAllItemAutoFailover<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>myFollowSearch<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>objectTransferFromClient<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>onePackSellEnabled<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>openDesign<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-string">&quot;,&quot;</span>personalChannelCallAllItemAutoFailover<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>personalSearchShowRecommendQuery<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>poiLocations<span class="hljs-string">&quot;:[],&quot;</span>poiType<span class="hljs-string">&quot;:&quot;</span><span class="hljs-string">&quot;,&quot;</span>privacyOptionEnabled<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>recallCouponItems<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>recallOutletsItem<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>recallSkuStockItems<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>recommendKeywords<span class="hljs-string">&quot;:[&quot;</span>小八平衡车<span class="hljs-string">&quot;,&quot;</span>小<span class="hljs-number">8</span>平衡车<span class="hljs-string">&quot;,&quot;</span>平衡车<span class="hljs-number">8</span><span class="hljs-string">&quot;,&quot;</span>元气<span class="hljs-number">100</span>平衡车<span class="hljs-string">&quot;,&quot;</span>速<span class="hljs-number">8</span>平衡车<span class="hljs-string">&quot;,&quot;</span>元气<span class="hljs-number">100</span><span class="hljs-string">&quot;,&quot;</span>单车<span class="hljs-string">&quot;,&quot;</span>自行车<span class="hljs-string">&quot;,&quot;</span>自行车山地<span class="hljs-string">&quot;,&quot;</span>山地车自行车<span class="hljs-string">&quot;,&quot;</span>自行车<span class="hljs-number">26</span>寸<span class="hljs-string">&quot;,&quot;</span>平衡车比赛<span class="hljs-string">&quot;,&quot;</span>山地自行车<span class="hljs-string">&quot;,&quot;</span>变速自行车<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">26</span>寸自行车<span class="hljs-string">&quot;,&quot;</span>皮带自行车儿童<span class="hljs-string">&quot;,&quot;</span>cargo自行车<span class="hljs-string">&quot;,&quot;</span>比赛平衡车<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">20</span>寸自行车+铝合金<span class="hljs-string">&quot;],&quot;</span>researchFlag<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>researchQuery<span class="hljs-string">&quot;:&quot;</span><span class="hljs-string">&quot;,&quot;</span>searchFeedsDataFrom<span class="hljs-string">&quot;:&quot;</span>IDLE_ALLDOM_SQI_SRP_FEEDS_DATA_FROM_IDLESEARCH<span class="hljs-string">&quot;,&quot;</span>showUserSubscribeButtonTip<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>showUserSubscribeEmptyResTip<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>showUserSubscribeLessResTip<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>singleControlInner<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>sourceScene<span class="hljs-string">&quot;:&quot;</span>main_search_empty_rec<span class="hljs-string">&quot;,&quot;</span>sqiCloseAlimamaAd<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>sqiCloseIdleAd<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>supportRecallSubscribePriceReduce<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>tppDataBecauseAutoFailover<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-string">&quot;,&quot;</span>unBlockItemPool<span class="hljs-string">&quot;:[],&quot;</span>userInputOriginalSearchKeywords<span class="hljs-string">&quot;:&quot;</span>bike<span class="hljs-string">&quot;&#125;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;suggestBucketNum&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;29&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;supportFlexFilter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>





<h1 id="搜索请求RPC"><a href="#搜索请求RPC" class="headerlink" title="搜索请求RPC"></a>搜索请求RPC</h1><h2 id="请求与响应的hook-点定位"><a href="#请求与响应的hook-点定位" class="headerlink" title="请求与响应的hook 点定位"></a>请求与响应的hook 点定位</h2><p>根据同一关键字的多次请求，可以发现<code>resultListLastIndex</code>字段的值发生改变，以及增加了<code>sqiControlFieldsJson</code>字段。jadx中搜索这两个关键字</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101630794.png" srcset="/img/loading.gif" lazyload></p>
<p>定位关键方法<code>resetPageNumber</code>以及<code>updatePageNumberAndIndex</code>方法。查看该方法的用例，定位到<code>refresh</code>以及<code>loadMore</code>方法。</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101630321.png" srcset="/img/loading.gif" lazyload></p>
<p>根据方法名以及代码逻辑，可以确定<code>refresh</code>和<code>loadMore</code>方法首先更新参数（刚才所提及的字段），然后调用<code>requestMtop</code>方法，该方法对<code>searchResultReq</code>填充字段，然后发送请求，主要代码部分如下</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101630740.png" srcset="/img/loading.gif" lazyload></p>
<p>请求成功调用<code>onSuccess</code>方法，该方法调用<code>access$100</code>方法</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101631606.png" srcset="/img/loading.gif" lazyload></p>
<p><code>ThreadUtils.runOnUI</code>方法顾名思义就是通过线程更新搜索结果展示的UI界面，<code>trackRefreshAndMore</code>方法则可能是日志记录。</p>
<p>很显然，我们可以利用这个hook点从<code>searchResultResp</code>对象中获取到响应结果。至于<code>SearchResultResp</code>中各个字段的含义，可以与响应结果进行对比，很容易知道这些字段都是什么内容。</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101631785.png" srcset="/img/loading.gif" lazyload></p>
<p>通过对比，知道了商品信息在<code>resultList</code>中。</p>
<p>响应结果获取的hook 点找到了，接下来就是找请求构造</p>
<p>hook  <code>refresh</code>和<code>loadMore</code>方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<br>        <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-keyword">let</span> <span class="hljs-title class_">SearchResultModel</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.taobao.idlefish.search_implement.mvp.model.SearchResultModel&quot;</span>);<br>            <span class="hljs-comment">// 首次搜索</span><br>            <span class="hljs-title class_">SearchResultModel</span>[<span class="hljs-string">&quot;refresh&quot;</span>].<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">onMtopCallback</span>) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`SearchResultModel.refresh is called: onMtopCallback=<span class="hljs-subst">$&#123;onMtopCallback.$className&#125;</span>`</span>);<br>                <span class="hljs-variable language_">this</span>[<span class="hljs-string">&quot;refresh&quot;</span>](onMtopCallback);<br>            &#125;;<br>            <span class="hljs-comment">// 加载更多</span><br>            <span class="hljs-title class_">SearchResultModel</span>[<span class="hljs-string">&quot;loadMore&quot;</span>].<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">z, onMtopCallback</span>) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`SearchResultModel.loadMore is called: z=<span class="hljs-subst">$&#123;z&#125;</span>, onMtopCallback=<span class="hljs-subst">$&#123;onMtopCallback.$className&#125;</span>`</span>);<br>                <span class="hljs-variable language_">this</span>[<span class="hljs-string">&quot;loadMore&quot;</span>](z, onMtopCallback);<br>            &#125;;<br>        &#125;<br>    )<br>&#125;<br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure>

<p>根据测试，可以确认<code>refresh</code>是重新加载与搜索关键字相关的商品，<code>loadMore</code>是加载更多与搜索关键字相关的商品。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs stylus">SearchResultModel<span class="hljs-selector-class">.refresh</span> is called: onMtopCallback=com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.search_implement</span><span class="hljs-selector-class">.mvp</span><span class="hljs-selector-class">.presenter</span>.SearchResultPresenter$<span class="hljs-number">1</span><br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Exception</span><br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.search_implement</span><span class="hljs-selector-class">.mvp</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.SearchResultModel</span><span class="hljs-selector-class">.refresh</span>(Native Method)<br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.search_implement</span><span class="hljs-selector-class">.mvp</span><span class="hljs-selector-class">.presenter</span><span class="hljs-selector-class">.SearchResultPresenter</span><span class="hljs-selector-class">.refreshAll</span>(SearchResultPresenter<span class="hljs-selector-class">.java</span>:<span class="hljs-number">26</span>)<br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.search_implement</span><span class="hljs-selector-class">.SearchResultActivity</span><span class="hljs-selector-class">.onCreate</span>(SearchResultActivity<span class="hljs-selector-class">.java</span>:<span class="hljs-number">39</span>)<br>        ...<br>SearchResultModel<span class="hljs-selector-class">.loadMore</span> is called: z=true, onMtopCallback=com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.search_implement</span><span class="hljs-selector-class">.mvp</span><span class="hljs-selector-class">.presenter</span>.SearchResultPresenter$<span class="hljs-number">1</span><br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Exception</span><br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.search_implement</span><span class="hljs-selector-class">.mvp</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.SearchResultModel</span><span class="hljs-selector-class">.loadMore</span>(SearchResultModel<span class="hljs-selector-class">.java</span>:<span class="hljs-number">9</span>)<br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.search_implement</span><span class="hljs-selector-class">.mvp</span><span class="hljs-selector-class">.presenter</span><span class="hljs-selector-class">.SearchResultPresenter</span><span class="hljs-selector-class">.loadMore</span>(SearchResultPresenter<span class="hljs-selector-class">.java</span>:<span class="hljs-number">46</span>)<br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.search_implement</span><span class="hljs-selector-class">.SearchResultActivity</span>.lambda<span class="hljs-variable">$onResultViewCreated</span>$<span class="hljs-number">3</span>(SearchResultActivity<span class="hljs-selector-class">.java</span>:<span class="hljs-number">3</span>)<br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.search_implement</span><span class="hljs-selector-class">.SearchResultActivity</span>.<span class="hljs-variable">$r8</span><span class="hljs-variable">$lambda</span>$<span class="hljs-built_in">-q-edhOrb4rz1ZyPRMmkJ54y4-A</span>(SearchResultActivity<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1</span>)<br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.search_implement</span>.SearchResultActivity$<span class="hljs-variable">$ExternalSyntheticLambda0</span><span class="hljs-selector-class">.onLoadMore</span>(R8$<span class="hljs-variable">$SyntheticClass</span>:<span class="hljs-number">3</span>)<br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.xcontainer</span><span class="hljs-selector-class">.view</span><span class="hljs-selector-class">.delegate</span><span class="hljs-selector-class">.ResultViewDelegate</span>.<span class="hljs-variable">$r8</span><span class="hljs-variable">$lambda</span><span class="hljs-variable">$ZcKRHTJ9</span><span class="hljs-built_in">-nlJiYKsFct2PK7btew</span>(ResultViewDelegate<span class="hljs-selector-class">.java</span>:<span class="hljs-number">5</span>)   <br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.xcontainer</span><span class="hljs-selector-class">.view</span><span class="hljs-selector-class">.delegate</span>.ResultViewDelegate$<span class="hljs-variable">$ExternalSyntheticLambda0</span><span class="hljs-selector-class">.onLoadMore</span>(R8$<span class="hljs-variable">$SyntheticClass</span>:<span class="hljs-number">3</span>)<br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.xcontainer</span><span class="hljs-selector-class">.listener</span><span class="hljs-selector-class">.recyclerview</span><span class="hljs-selector-class">.OnScrollStateListener</span><span class="hljs-selector-class">.loadMore</span>(OnScrollStateListener<span class="hljs-selector-class">.java</span>:<span class="hljs-number">27</span>)<br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.xcontainer</span><span class="hljs-selector-class">.listener</span><span class="hljs-selector-class">.recyclerview</span><span class="hljs-selector-class">.OnScrollStateListener</span><span class="hljs-selector-class">.onScrolled</span>(OnScrollStateListener<span class="hljs-selector-class">.java</span>:<span class="hljs-number">197</span>)<br>		...<br></code></pre></td></tr></table></figure>

<p>它们的回调函数都是<code>com.taobao.idlefish.search_implement.mvp.presenter.SearchResultPresenter$1</code>匿名函数。</p>
<p>通过堆栈可以发现，<code>refresh</code>和<code>loadMore</code>方法分别由<code>SearchResultPresenter</code>类中的<code>refreshAll</code>和<code>loadMore</code>方法调用而来的。再往前溯源，则是<code>SearchResultActivity</code>类中的方法了，很显然，这是搜索结果展示页面。它对应的<code>onCreate()</code>方法如下</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101631250.png" srcset="/img/loading.gif" lazyload></p>
<p>其中<code>initRequestParams</code>顾名思义就是初始化请求参数，这里很可能就有我们的搜索关键字。</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101631240.png" srcset="/img/loading.gif" lazyload></p>
<p>frida hook该方法，打印<code>routerParams</code>字段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<br>        <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-keyword">let</span> <span class="hljs-title class_">SearchResultActivity</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.taobao.idlefish.search_implement.SearchResultActivity&quot;</span>);<br>            <span class="hljs-title class_">SearchResultActivity</span>[<span class="hljs-string">&quot;initRequestParams&quot;</span>].<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>                <span class="hljs-variable language_">this</span>[<span class="hljs-string">&quot;onCreate&quot;</span>](bundle);<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;routerParams: &quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">routerParams</span>.<span class="hljs-property">value</span>);<br>            &#125;;<br>        &#125;<br>    )<br>&#125;<br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure>

<p>结果如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs json">routerParams<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;_from__&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;searchresult&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;animated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;false&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;bizFrom&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;home&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;extraFilterValue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;divisionList&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;excludeMultiPlacesSellers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;flutter_animated&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;false&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;hide_splash_screen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;true&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;initSubPageTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;searchResult&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;isFadeIn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;false&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;isOldFriendly&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;false&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;keyword&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;phone&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;kitSearchOnce&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;false&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;searchReqFromActivatePagePart&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;searchButton&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;searchReqFromPage&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xyHome&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;searchTabType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;SEARCH_TAB_MAIN&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;shadeBucketNum&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;-1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;suggestBucketNum&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;29&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>此时我们的搜索关键字（”phone”）已经存在了。</p>
<p>梳理一下搜索功能的代码逻辑，首先会通过<code>SearchResultActivity.onCreate()</code>方法创建搜索结果展示页面，该方法里面会填充基本的请求参数（此时还未生成<code>x-</code>系列），创建一个<code>searchResultPresenter</code>实例，然后调用<code>refreshAll()</code>方法进行首次网络请求，该方法进一步调用<code>SearchResultModel.refresh()</code>方法，设置页码以及<code>sqicontrol</code>字段的值，最终通过<code>requestMtop()</code>方法完成请求的最后组装，最终发送请求。如果是加载更多商品，则是调用<code>SearchResultPresenter.loadMore()</code>方法，后续步骤类似，不在讲述。</p>
<h2 id="RPC制作"><a href="#RPC制作" class="headerlink" title="RPC制作"></a>RPC制作</h2><p>通过内存搜索<code>SearchResultActivity</code>、<code>SearchResultPresenter</code>、<code>SearchResultModel</code>三个实例，发现只有在搜索页面出现的情况下才在内存中存在唯一实例，因此可以借助这些实例来完成自己的任意关键字搜索。</p>
<p>思路如下：</p>
<p>选取的hook点为<code>searchResultModel</code>的<code>refresh</code>和<code>loadMore</code>方法，因为符合功能最小化原则（防止后续调用过多无关函数），且这两个hook点会自动处理参数生成（如<code>x-</code>系列），以及自动根据响应结果更新请求（<code>updatePageNumberAndIndex</code>、<code>updateSqiControlFieldsJson</code>）。</p>
<p>最主要是搜索关键字的修改，需要注意的是修改<code>routerParams</code>无效！因为<code>routerParams</code>虽然在<code>requestMtop</code>方法中存在使用，但并没有修改<code>request</code>的<code>keyword</code>，因此我们需要直接获取<code>request</code>实例然后修改<code>keyword</code>字段。最后需在<code>access$100</code>处解析响应结果，但是不要调用原方法，以防止回调函数触发导致一系列可能的报错。</p>
<p>rpc脚本如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Cached</span> = &#123;<br>    <span class="hljs-attr">searchResultPresenter</span>: <span class="hljs-literal">null</span>,<br>    <span class="hljs-attr">searchResultModel</span>: <span class="hljs-literal">null</span>,<br>    <span class="hljs-attr">keyword</span>: <span class="hljs-literal">null</span>,<br>    <span class="hljs-attr">pendingResolve</span>: <span class="hljs-literal">null</span> <span class="hljs-comment">// 新增：用于将数据同步回传给 RPC 调用者</span><br>&#125;<br><br><span class="hljs-comment">// 1. 预先获取类引用，避免在 RPC 中重复查找</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Classes</span> = &#123;<br>    <span class="hljs-title class_">SearchResultPresenter</span>: <span class="hljs-literal">null</span>,<br>    <span class="hljs-title class_">SearchResultModel</span>: <span class="hljs-literal">null</span>,<br>    <span class="hljs-title class_">AnonymousClass1</span>: <span class="hljs-literal">null</span>,<br>    <span class="hljs-title class_">JSON</span>: <span class="hljs-literal">null</span>,<br>    <span class="hljs-title class_">SearchResultResp</span>: <span class="hljs-literal">null</span><br>&#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-comment">// 缓存类引用</span><br>        <span class="hljs-title class_">Classes</span>.<span class="hljs-property">SearchResultPresenter</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.taobao.idlefish.search_implement.mvp.presenter.SearchResultPresenter&quot;</span>);<br>        <span class="hljs-title class_">Classes</span>.<span class="hljs-property">SearchResultModel</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.taobao.idlefish.search_implement.mvp.model.SearchResultModel&quot;</span>);<br>        <span class="hljs-title class_">Classes</span>.<span class="hljs-property">AnonymousClass1</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.taobao.idlefish.search_implement.mvp.presenter.SearchResultPresenter$1&quot;</span>);<br>        <span class="hljs-title class_">Classes</span>.<span class="hljs-property">JSON</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.alibaba.fastjson.JSON&quot;</span>);<br>        <span class="hljs-title class_">Classes</span>.<span class="hljs-property">SearchResultResp</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.taobao.idlefish.search_implement.protocol.SearchResultResp&quot;</span>);<br>        <span class="hljs-comment">// 初始获取 SearchResultPresenter 实例</span><br>        <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">choose</span>(<span class="hljs-title class_">Classes</span>.<span class="hljs-property">SearchResultPresenter</span>.<span class="hljs-property">$className</span>, &#123;<br>            <span class="hljs-attr">onMatch</span>: <span class="hljs-function">(<span class="hljs-params">instance</span>) =&gt;</span> &#123;<br>                <span class="hljs-title class_">Cached</span>.<span class="hljs-property">searchResultPresenter</span> = instance;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] 找到 SearchResultPresenter 实例: &quot;</span> + instance);<br>            &#125;,<br>            <span class="hljs-attr">onComplete</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;未找到 SearchResultPresenter 实例。请将闲鱼App置于搜索结果页面后重试。&quot;</span>);<br>            &#125;<br>        &#125;);<br><br>        <span class="hljs-title class_">Cached</span>.<span class="hljs-property">searchResultModel</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">cast</span>(<span class="hljs-title class_">Cached</span>.<span class="hljs-property">searchResultPresenter</span>.<span class="hljs-title function_">getModel</span>(), <span class="hljs-title class_">Classes</span>.<span class="hljs-property">SearchResultModel</span>);<br>        <span class="hljs-comment">// hook access$100 方法以捕获响应</span><br>        <span class="hljs-title class_">Classes</span>.<span class="hljs-property">SearchResultModel</span>[<span class="hljs-string">&quot;access$100&quot;</span>].<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">model, i, req, resp, callback</span>) &#123;<br>            <span class="hljs-keyword">const</span> jsonString = <span class="hljs-title class_">Classes</span>.<span class="hljs-property">JSON</span>.<span class="hljs-title function_">toJSONString</span>(<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">cast</span>(resp, <span class="hljs-title class_">Classes</span>.<span class="hljs-property">SearchResultResp</span>));<br>            <span class="hljs-comment">// A. 如果有 RPC 正在等待，直接通过 Promise 返回</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Cached</span>.<span class="hljs-property">pendingResolve</span>) &#123;<br>                <span class="hljs-title class_">Cached</span>.<span class="hljs-title function_">pendingResolve</span>(jsonString);<br>                <span class="hljs-title class_">Cached</span>.<span class="hljs-property">pendingResolve</span> = <span class="hljs-literal">null</span>;   <br>            &#125;<br>        &#125;;<br><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Hooks and Classes initialized.&quot;</span>);<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">keyword</span>) &#123;<br>    <span class="hljs-comment">// 必须返回 Promise，否则 Python 端无法通过 rpc 接收到 resolve 的数据</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">// 将当前 resolve 句柄存入全局，供 access$100 异步触发</span><br>        <span class="hljs-title class_">Cached</span>.<span class="hljs-property">pendingResolve</span> = resolve;<br><br>        <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> callback = <span class="hljs-title class_">Classes</span>.<span class="hljs-property">AnonymousClass1</span>.$new(<span class="hljs-title class_">Cached</span>.<span class="hljs-property">searchResultPresenter</span>);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Cached</span>.<span class="hljs-property">keyword</span> === <span class="hljs-literal">null</span> || <span class="hljs-title class_">Cached</span>.<span class="hljs-property">keyword</span> !== keyword) &#123;<br>                <span class="hljs-comment">// 修改关键词并执行刷新</span><br>                <span class="hljs-keyword">let</span> req = <span class="hljs-title class_">Cached</span>.<span class="hljs-property">searchResultModel</span>.<span class="hljs-property">request</span>.<span class="hljs-property">value</span>;<br>                req.<span class="hljs-property">keyword</span>.<span class="hljs-property">value</span> = keyword;<br>                <br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[RPC] 执行刷新: &quot;</span> + keyword);<br>                <span class="hljs-title class_">Cached</span>.<span class="hljs-property">searchResultModel</span>.<span class="hljs-title function_">refresh</span>(callback);<br>                <br>                <span class="hljs-title class_">Cached</span>.<span class="hljs-property">keyword</span> = keyword;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// 关键词相同，执行加载更多</span><br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[RPC] 执行加载更多&quot;</span>);<br>                <span class="hljs-title class_">Cached</span>.<span class="hljs-property">searchResultModel</span>.<span class="hljs-title function_">loadMore</span>(<span class="hljs-literal">true</span>, callback);<br>            &#125;<br>        &#125;);<br>    &#125;);<br>&#125;<br><br><span class="hljs-comment">// 初始化</span><br><span class="hljs-title function_">init</span>();<br><br><span class="hljs-comment">// 4. 定义 RPC 导出</span><br>rpc.<span class="hljs-property">exports</span> = &#123;<br>    <span class="hljs-comment">// 统一触发方法</span><br>    <span class="hljs-attr">search</span>: search<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>python端代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> frida<br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">pid</span>):<br>    <br>    session = frida.get_usb_device().attach(pid)<br>    <br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;xianyurpc.js&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        script_content = f.read()<br><br>    script = session.create_script(script_content)<br>    script.load()<br><br>    <span class="hljs-comment"># ———————示例——————</span><br>    <span class="hljs-comment"># 第一次搜关键词，触发 refresh</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;正在搜索自行车...&quot;</span>)<br>    res_json = script.exports_sync.search(<span class="hljs-string">&quot;自行车&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;搜索结果详情:&quot;</span>, res_json[:<span class="hljs-number">100</span>] + <span class="hljs-string">&quot;...&quot;</span>) <span class="hljs-comment"># 打印前100个字符</span><br><br>    <span class="hljs-comment"># 第二次搜相同关键词，触发 loadMore</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;加载更多结果...&quot;</span>)<br>    more_json = script.exports_sync.search(<span class="hljs-string">&quot;自行车&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;更多结果详情:&quot;</span>, more_json[:<span class="hljs-number">100</span>] + <span class="hljs-string">&quot;...&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main(<span class="hljs-number">23686</span>)<br></code></pre></td></tr></table></figure>

<p>以及导出成服务端API</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> frida<br><span class="hljs-keyword">import</span> uvicorn<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Query, HTTPException<br><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> asynccontextmanager<br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-comment"># --- 全局变量管理 ---</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FridaManager</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.session = <span class="hljs-literal">None</span><br>        self.script = <span class="hljs-literal">None</span><br>        self.device = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_frida</span>(<span class="hljs-params">self, package_name=<span class="hljs-string">&quot;闲鱼&quot;</span></span>): <span class="hljs-comment"># &quot;com.taobao.idlefish&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            self.device = frida.get_usb_device()<br>            self.session = self.device.attach(package_name)<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;xianyurpc.js&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>                self.script = self.session.create_script(f.read())<br><br>            self.script.load()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Successfully attached to Idlefish and loaded script.&quot;</span>)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Failed to init Frida: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>manager = FridaManager()<br><br><span class="hljs-comment"># 使用 FastAPI 的生命周期管理</span><br><span class="hljs-meta">@asynccontextmanager</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">lifespan</span>(<span class="hljs-params">app: FastAPI</span>):<br>    manager.init_frida()<br>    <span class="hljs-keyword">yield</span><br>    <span class="hljs-keyword">if</span> manager.session:<br>        manager.session.detach()<br><br>app = FastAPI(lifespan=lifespan)<br><br><span class="hljs-comment"># --- API 路由 ---</span><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/search&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">api_search</span>(<span class="hljs-params">q: <span class="hljs-built_in">str</span> = Query(<span class="hljs-params">..., description=<span class="hljs-string">&quot;搜索关键词&quot;</span></span>)</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    HTTP 接口：搜索商品</span><br><span class="hljs-string">    q: 关键词</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> manager.script:<br>        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-string">&quot;Frida script not loaded&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 调用 Frida RPC</span><br>        <span class="hljs-comment"># exports_sync 是阻塞的，直到 JS 里的 resolve 被调用</span><br>        result_json = manager.script.exports_sync.search(q)<br>        <br>        <span class="hljs-comment"># 将字符串转为 JSON 对象返回给 Web 客户端</span><br>        <span class="hljs-keyword">return</span> json.loads(result_json)<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-built_in">str</span>(e))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 启动 Web 服务</span><br>    uvicorn.run(app, host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">8000</span>)<br></code></pre></td></tr></table></figure>

<p>网络访问<code>/search</code> API的果如下</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101632003.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="x-系列参数生成定位"><a href="#x-系列参数生成定位" class="headerlink" title="x-系列参数生成定位"></a>x-系列参数生成定位</h1><h2 id="native层定位"><a href="#native层定位" class="headerlink" title="native层定位"></a>native层定位</h2><p>以<code>x-sgext</code>为例， hook HashMap过滤<code>x-sgext</code>并打印函数调用堆栈</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> hashMap = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;java.util.HashMap&quot;</span>);<br>        hashMap.<span class="hljs-property">put</span>.<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) &#123;<br>            <span class="hljs-keyword">if</span> (a != <span class="hljs-literal">null</span> &amp;&amp; a.<span class="hljs-title function_">equals</span>(<span class="hljs-string">&quot;x-sgext&quot;</span>)) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Hooked x-sgext header: &quot;</span> + b);<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.util.Log&quot;</span>).<span class="hljs-title function_">getStackTraceString</span>(<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;java.lang.Exception&quot;</span>).$new()));<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">put</span>(a, b);<br>        &#125;<br>    &#125;)<br>&#125;<br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure>

<p>结果如下</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stylus">hooked x-sgext <span class="hljs-selector-tag">header</span>: JBKuXHhu9np+<span class="hljs-number">9</span>obhAvi89FyfbJ9lnH+ca51lnX+cbI1/n2uYa5Zpnm2cbo1snGjPbJ5sn23PacpkzWqWf59qjW2cf5xsjWyebJl/mH+ff59/n3+ff59/n3+ff59/n3+ef55/nn+ef55/nn+ef405jWyNbI04nWTNbJx/nmyebJ5/nn+cOM9/nn+Nb41tjWyNb40m7w/Wf55/jnyfbI58n2+NaPFuiGqXepx6nnqXep56nnqXep96nnqeep96n2+dbZ5riA7EM/Fp8WyIbIhql2nIaJ49mXqeep56nnqeep56ngPPA5x6nnqeA59s8Q7/GfQT4B3BOeEa7x3sJM0a73eePfcX72zgc98VxhXvDp8GyRHsBO8d7AzjMvkVzy/ZGoEX6w3tH+s2yRbJF+<span class="hljs-number">8</span>D<br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Exception</span><br>        at java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.HashMap</span><span class="hljs-selector-class">.put</span>(Native Method)<br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.wireless</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.adapter</span><span class="hljs-selector-class">.JNICLibrary</span><span class="hljs-selector-class">.doCommandNative</span>(Native Method)<br>        at com<span class="hljs-selector-class">.alibaba</span><span class="hljs-selector-class">.wireless</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.mainplugin</span>.б<span class="hljs-selector-class">.doCommand</span>(Unknown Source:<span class="hljs-number">0</span>)<br>        at com<span class="hljs-selector-class">.alibaba</span><span class="hljs-selector-class">.wireless</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.middletierplugin</span><span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.a</span><span class="hljs-selector-class">.a</span>(Unknown Source:<span class="hljs-number">370</span>)<br>        at com<span class="hljs-selector-class">.alibaba</span><span class="hljs-selector-class">.wireless</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.middletierplugin</span><span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.d</span>.a<span class="hljs-variable">$a</span><span class="hljs-selector-class">.invoke</span>(Unknown Source:<span class="hljs-number">56</span>)<br>        at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.Proxy</span><span class="hljs-selector-class">.invoke</span>(Proxy<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1006</span>)<br>        at <span class="hljs-variable">$Proxy29</span><span class="hljs-selector-class">.getSecurityFactors</span>(Unknown Source)<br>        at mtopsdk<span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.InnerSignImpl</span><span class="hljs-selector-class">.getUnifiedSign</span>(InnerSignImpl<span class="hljs-selector-class">.java</span>:<span class="hljs-number">299</span>)<br>        at mtopsdk<span class="hljs-selector-class">.mtop</span><span class="hljs-selector-class">.protocol</span><span class="hljs-selector-class">.builder</span><span class="hljs-selector-class">.impl</span><span class="hljs-selector-class">.InnerProtocolParamBuilderImpl</span><span class="hljs-selector-class">.buildParams</span>(InnerProtocolParamBuilderImpl<span class="hljs-selector-class">.java</span>:<span class="hljs-number">853</span>)<br>        at mtopsdk<span class="hljs-selector-class">.framework</span><span class="hljs-selector-class">.filter</span><span class="hljs-selector-class">.before</span><span class="hljs-selector-class">.ProtocolParamBuilderBeforeFilter</span><span class="hljs-selector-class">.doBefore</span>(ProtocolParamBuilderBeforeFilter<span class="hljs-selector-class">.java</span>:<span class="hljs-number">6</span>)<br>        ...<br></code></pre></td></tr></table></figure>

<p><code>com.taobao.wireless.security.adapter.JNICLibrary.doCommandNative</code>在jadx中搜索不到，显然这个类是动态加载的（通过<code>.jar</code>或<code>.dex</code>形式动态加载）。使用 frida 来枚举一下 classloader 来定位这个类在哪个文件中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">findTargetClassWhere</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> targetClass = <span class="hljs-string">&quot;com.taobao.wireless.security.adapter.JNICLibrary&quot;</span>;<br>        <span class="hljs-keyword">var</span> found = <span class="hljs-literal">false</span>;<br>        <span class="hljs-comment">// 枚举所有的 ClassLoader</span><br>        <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">enumerateClassLoaders</span>(&#123;<br>            <span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">loader</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-comment">// 尝试在当前 loader 中加载目标类</span><br>                    <span class="hljs-keyword">if</span> (loader.<span class="hljs-title function_">findClass</span>(targetClass)) &#123;<br>                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] 找到目标类: &quot;</span> + targetClass);<br>                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] 所在的 ClassLoader: &quot;</span> + loader);<br>                        found = <span class="hljs-literal">true</span>;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">catch</span> (e) &#123;&#125;<br>            &#125;,<br>            <span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>                <span class="hljs-keyword">if</span> (!found) &#123;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[-] 在所有 ClassLoader 中均未找到该类。&quot;</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] 搜索完毕。&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;);<br>    &#125;)<br>&#125;<br><br><span class="hljs-title function_">setImmediate</span>(findTargetClassWhere);<br></code></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[+] 找到目标类: com.taobao.wireless.security.adapter.JNICLibrary<br>[+] 所在的 ClassLoader: dalvik.system.PathClassLoader[DexPathList[[zip <span class="hljs-keyword">file</span> <span class="hljs-string">&quot;/data/app/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/lib/arm64/libsgmain.so&quot;</span>],nativeLibraryDirectories=[<span class="hljs-regexp">/data/</span>app<span class="hljs-regexp">/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/</span>lib<span class="hljs-regexp">/arm64, /</span>data<span class="hljs-regexp">/user/</span><span class="hljs-number">0</span><span class="hljs-regexp">/com.taobao.idlefish/</span>app_SGLib<span class="hljs-regexp">/app_1767620786/m</span>ain, <span class="hljs-regexp">/system/</span>lib64, <span class="hljs-regexp">/vendor/</span>lib64, <span class="hljs-regexp">/system/</span>product/lib64]]]<br>[*] 搜索完毕。<br></code></pre></td></tr></table></figure>

<p>classloader里的第一个文件就是我们要找的，名为<code>libsgmain.so</code>。看似是so文件，其实是jar文件，将其从对应文件夹中提取出来，放入jadx中进行分析。</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101632079.png" srcset="/img/loading.gif" lazyload></p>
<p>接下来就定位<code>doCommandNative</code>函数在哪个so库中，由于它可能是静态加载也可能是动态加载，因此我们要 hook JNI 的 RegisterNatives 函数以及 libdl.so 的 dlsym 函数，代码如下（通过spawn方式启动）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">FindNativeMethod</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-comment">//寻找动态注册函数</span><br>    <span class="hljs-comment">// find RegisterNatives</span><br>    <span class="hljs-keyword">let</span> addrRegisterNatives = <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">var</span> symbols = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(<span class="hljs-string">&quot;libart.so&quot;</span>).<span class="hljs-title function_">enumerateSymbols</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; symbols.<span class="hljs-property">length</span>; i++)&#123;<br>        <span class="hljs-keyword">var</span> symbolName = symbols[i].<span class="hljs-property">name</span>;<br>        <span class="hljs-keyword">if</span> (symbolName.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;CheckJNI&quot;</span>) == -<span class="hljs-number">1</span> &amp;&amp; symbolName.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;JNI&quot;</span>) &gt;= <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">if</span>(symbolName.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;RegisterNatives&quot;</span>) &gt;= <span class="hljs-number">0</span>)&#123;<br>                addrRegisterNatives = symbols[i].<span class="hljs-property">address</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] RegisterNatives address: &quot;</span> + addrRegisterNatives);<br><br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(addrRegisterNatives, &#123;<br>        <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>)&#123;<br>            <span class="hljs-keyword">var</span> env = args[<span class="hljs-number">0</span>];<br>            <span class="hljs-keyword">var</span> className = <span class="hljs-title class_">Java</span>.<span class="hljs-property">vm</span>.<span class="hljs-title function_">tryGetEnv</span>().<span class="hljs-title function_">getClassName</span>(args[<span class="hljs-number">1</span>]);<br>            <span class="hljs-keyword">var</span> methods = args[<span class="hljs-number">2</span>];<br>            <span class="hljs-keyword">var</span> methodCount = args[<span class="hljs-number">3</span>].<span class="hljs-title function_">toInt32</span>();<br>            <span class="hljs-keyword">if</span> (className.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;JNICLibrary&quot;</span>) != -<span class="hljs-number">1</span>)&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] ================== Class: &quot;</span> + className + <span class="hljs-string">&quot; ======================&quot;</span>);<br>                <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; methodCount; i++)&#123;<br>                    <span class="hljs-keyword">var</span> idx = i * <span class="hljs-title class_">Process</span>.<span class="hljs-property">pointerSize</span> * <span class="hljs-number">3</span>;<br>                    <span class="hljs-keyword">var</span> methodName = methods.<span class="hljs-title function_">add</span>(idx).<span class="hljs-title function_">readPointer</span>().<span class="hljs-title function_">readCString</span>();<br>                    <span class="hljs-keyword">var</span> methodSign = methods.<span class="hljs-title function_">add</span>(idx + <span class="hljs-title class_">Process</span>.<span class="hljs-property">pointerSize</span>).<span class="hljs-title function_">readPointer</span>().<span class="hljs-title function_">readCString</span>();<br>                    <span class="hljs-keyword">var</span> methodAddr = methods.<span class="hljs-title function_">add</span>(idx + <span class="hljs-number">2</span> * <span class="hljs-title class_">Process</span>.<span class="hljs-property">pointerSize</span>).<span class="hljs-title function_">readPointer</span>();<br>                    <span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByAddress</span>(methodAddr);<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] methodName: &quot;</span> + methodName + <span class="hljs-string">&quot;, methodSignature: &quot;</span> + methodSign + <span class="hljs-string">&quot;, methodAddress: &quot;</span> + methodAddr, <span class="hljs-string">&quot;, offset: &quot;</span> + methodAddr.<span class="hljs-title function_">sub</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>));<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] moduleName: &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;, moduleAddress: &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;)<br><br>    <span class="hljs-comment">//寻找静态注册函数</span><br>    <span class="hljs-keyword">let</span> dlsymFuncAddr = <span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findExportByName</span>(<span class="hljs-string">&#x27;libdl.so&#x27;</span>, <span class="hljs-string">&#x27;dlsym&#x27;</span>);<br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(dlsymFuncAddr, &#123;<br>        <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">libAddr</span> = <span class="hljs-title function_">ptr</span>(args[<span class="hljs-number">0</span>]); <span class="hljs-comment">// args[0]是库基址</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">funcName</span> = <span class="hljs-title function_">ptr</span>(args[<span class="hljs-number">1</span>]); <span class="hljs-comment">// args[1]是函数名</span><br>        &#125;,<br>        <span class="hljs-attr">onLeave</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">retval</span>) &#123;<br>            <span class="hljs-keyword">let</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByAddress</span>(retval);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">funcName</span>.<span class="hljs-title function_">readCString</span>().<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;doCommandNative&quot;</span>) != -<span class="hljs-number">1</span>)&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;function name: &quot;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">funcName</span>.<span class="hljs-title function_">readCString</span>(),<br>                    <span class="hljs-string">&quot;lib name: &quot;</span>, <span class="hljs-variable language_">module</span>.<span class="hljs-property">name</span>,<br>                    <span class="hljs-string">&quot;function&#x27;s memory address: &quot;</span>, retval, <br>                    <span class="hljs-string">&quot;function offset: &quot;</span>, retval.<span class="hljs-title function_">sub</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>)<br>                );<br>            &#125;<br>        &#125;,<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>打印如下</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">*</span>] <span class="hljs-string">==================</span> <span class="hljs-attr">Class:</span> <span class="hljs-string">com.taobao.wireless.security.adapter.JNICLibrary</span> <span class="hljs-string">======================</span><br>[<span class="hljs-string">*</span>] <span class="hljs-attr">methodName:</span> <span class="hljs-string">doCommandNative,</span> <span class="hljs-attr">methodSignature:</span> <span class="hljs-string">(I[Ljava/lang/Object;)Ljava/lang/Object;,</span> <span class="hljs-attr">methodAddress:</span> <span class="hljs-number">0x7d103e90c4</span> <span class="hljs-string">,</span> <span class="hljs-attr">offset:</span> <span class="hljs-number">0x280c4</span><br>[<span class="hljs-string">*</span>] <span class="hljs-attr">moduleName:</span> <span class="hljs-string">libsgmainso-6.6.231201.33656539.so,</span> <span class="hljs-attr">moduleAddress:</span> <span class="hljs-number">0x7d103c1000</span><br></code></pre></td></tr></table></figure>

<p>ida分析该函数 0x280c4 ，发现都是BR间接跳转。</p>
<h2 id="间接跳转去混淆"><a href="#间接跳转去混淆" class="headerlink" title="间接跳转去混淆"></a>间接跳转去混淆</h2><p>对应BR间接跳转混淆的修复，可以借助frida stalker将<code>doCommandNative</code>的指令轨迹记录下来，同时记录<code>br\blr</code>指令的跳转地址。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">traceInsns</span>(<span class="hljs-params">moduleName, traceOffset</span>) &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(moduleName);<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">module</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Module not found: &quot;</span> + moduleName);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] Found module: &quot;</span> + moduleName + <span class="hljs-string">&quot; at &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>);<br><br>    <span class="hljs-keyword">let</span> file = <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">let</span> logPath = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> context = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;android.app.ActivityThread&#x27;</span>).<span class="hljs-title function_">currentApplication</span>().<span class="hljs-title function_">getApplicationContext</span>();<br>        <span class="hljs-comment">// 获取 /data/user/0/com.taobao.idlefish/files 目录</span><br>        <span class="hljs-keyword">const</span> filesDir = context.<span class="hljs-title function_">getFilesDir</span>().<span class="hljs-title function_">getAbsolutePath</span>();<br>        logPath = filesDir + <span class="hljs-string">`/<span class="hljs-subst">$&#123;moduleName&#125;</span>_<span class="hljs-subst">$&#123;traceOffset&#125;</span>.txt`</span>;<br>        file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(logPath, <span class="hljs-string">&quot;w&quot;</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] 日志初始化成功: &quot;</span> + logPath);<br>    &#125;);<br><br>    <span class="hljs-comment">// 定义追踪范围</span><br>    <span class="hljs-keyword">const</span> moduleStart = <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>;<br>    <span class="hljs-keyword">const</span> moduleEnd = <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">size</span>);<br><br>    <span class="hljs-keyword">const</span> traceStart = moduleStart.<span class="hljs-title function_">add</span>(traceOffset);<br><br>    <span class="hljs-comment">// 全局锁：确保只跟踪一个全流程</span><br>    <span class="hljs-keyword">let</span> isTracking = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">let</span> targetThreadId = -<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">let</span> insn_count = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(traceStart, &#123;<br>        <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) &#123;<br>            <span class="hljs-keyword">const</span> cmdId = args[<span class="hljs-number">2</span>].<span class="hljs-title function_">toInt32</span>(); <span class="hljs-comment">// cmdId</span><br>            <span class="hljs-keyword">if</span> (cmdId != <span class="hljs-number">70102</span> || isTracking) &#123;<span class="hljs-comment">//由于doCommandNative多次触发，因此限制仅记录一次</span><br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;start tracing instructions for cmdId 70102...&quot;</span>);<br>            isTracking = <span class="hljs-literal">true</span>;<br>            targetThreadId = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">getCurrentThreadId</span>();<br>            <span class="hljs-title class_">Stalker</span>.<span class="hljs-title function_">follow</span>(targetThreadId, &#123;<br>                <span class="hljs-attr">transform</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">iterator</span>) &#123;<br>                    <span class="hljs-keyword">let</span> instruction = iterator.<span class="hljs-title function_">next</span>();<br>                    <span class="hljs-keyword">while</span> (instruction !== <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-keyword">const</span> address = instruction.<span class="hljs-property">address</span>;<br><br>                        <span class="hljs-comment">// 判断是否是目标模块内的指令</span><br>                        <span class="hljs-keyword">if</span> (address.<span class="hljs-title function_">compare</span>(moduleStart) &gt;= <span class="hljs-number">0</span> &amp;&amp; address.<span class="hljs-title function_">compare</span>(moduleEnd) &lt;= <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-comment">// 解析当前指令涉及的寄存器</span><br>                            <span class="hljs-keyword">const</span> insn_str = instruction.<span class="hljs-title function_">toString</span>();<br>                            <span class="hljs-comment">// 针对 br 以及 blr 指令，解析它使用的寄存器名</span><br>                            <span class="hljs-keyword">let</span> targetReg = <span class="hljs-literal">null</span>;<br>                            <span class="hljs-keyword">if</span> (instruction.<span class="hljs-property">mnemonic</span> === <span class="hljs-string">&#x27;br&#x27;</span> || instruction.<span class="hljs-property">mnemonic</span> === <span class="hljs-string">&#x27;blr&#x27;</span>) &#123;<br>                                <span class="hljs-keyword">const</span> ops = instruction.<span class="hljs-property">operands</span>;<br>                                <span class="hljs-keyword">if</span> (ops.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; ops[<span class="hljs-number">0</span>].<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;reg&#x27;</span>) &#123;<br>                                    <span class="hljs-keyword">let</span> r = <span class="hljs-title class_">String</span>(ops[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>);<br>                                    <span class="hljs-comment">// 统一转为 xN 格式适配 context</span><br>                                    targetReg = r.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;w&#x27;</span>) ? <span class="hljs-string">&#x27;x&#x27;</span> + r.<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>) : r;<br>                                &#125;<br>                            &#125;<br>                            <span class="hljs-comment">// 插入 Callout</span><br>                            iterator.<span class="hljs-title function_">putCallout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) &#123;<br>                                <span class="hljs-keyword">let</span> logLine = <span class="hljs-string">`[<span class="hljs-subst">$&#123;moduleName&#125;</span> <span class="hljs-subst">$&#123;address.sub(moduleStart)&#125;</span>]<span class="hljs-subst">$&#123;address&#125;</span>: &quot;<span class="hljs-subst">$&#123;insn_str&#125;</span>&quot;`</span>;<br>                                <span class="hljs-comment">// 如果是 br 指令，额外补充寄存器的值</span><br>                                <span class="hljs-keyword">if</span> (targetReg !== <span class="hljs-literal">null</span>) &#123;<br>                                    <span class="hljs-keyword">const</span> regValue = context[targetReg];<br>                                    logLine += <span class="hljs-string">&quot; ==&gt; &quot;</span> + targetReg + <span class="hljs-string">&quot; = &quot;</span> + <span class="hljs-title class_">String</span>(regValue.<span class="hljs-title function_">sub</span>(moduleStart));<br>                                &#125;<br>                                <span class="hljs-comment">// console.log(logLine);</span><br>                                file.<span class="hljs-title function_">write</span>(logLine + <span class="hljs-string">&quot;\n&quot;</span>);<br>                                insn_count += <span class="hljs-number">1</span>;<br>                                <span class="hljs-keyword">if</span> (insn_count % <span class="hljs-number">1000000</span> === <span class="hljs-number">0</span>) &#123;<br>                                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`traced <span class="hljs-subst">$&#123;insn_count&#125;</span> instructions...`</span>);<br>                                &#125;<br>                            &#125;);<br>                        &#125;<br>                        iterator.<span class="hljs-title function_">keep</span>();<br>                        instruction = iterator.<span class="hljs-title function_">next</span>();<br>                    &#125;<br>                &#125;<br>            &#125;);<br>        &#125;,<br>        <span class="hljs-attr">onLeave</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">retval</span>) &#123;<br>            <span class="hljs-keyword">if</span> (isTracking &amp;&amp; <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">getCurrentThreadId</span>() === targetThreadId) &#123;<br>                <span class="hljs-title class_">Stalker</span>.<span class="hljs-title function_">unfollow</span>(targetThreadId);<br>                <span class="hljs-title class_">Stalker</span>.<span class="hljs-title function_">flush</span>();<br>                file.<span class="hljs-title function_">flush</span>();<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;trace finished!&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> moduleName = <span class="hljs-string">&quot;libsgmainso-6.6.231201.33656539.so&quot;</span>;<br>    <span class="hljs-keyword">const</span> traceOffset = <span class="hljs-number">0x280c4</span>;<br>    <span class="hljs-title function_">traceInsns</span>(moduleName, traceOffset);<br>&#125;<br><br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure>

<p>然后再从日志中提取<code>br\blr</code>指令中的地址，对于固定跳转地址的指令，进行间接跳转指令的修复。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_trace</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-comment"># 正则：捕获[指令相对偏移]和[br跳转的目标值]</span><br>    pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;0x([0-9a-fA-F]+)\].*br\s+\w+\&quot; ==&gt; \w+\s+=\s+0x([0-9a-fA-F]+)&quot;</span>)<br>    <span class="hljs-comment"># 存储格式: &#123;指令地址: set(跳转目标1, 跳转目标2...)&#125;</span><br>    br_map = defaultdict(<span class="hljs-built_in">set</span>)<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>            <span class="hljs-keyword">match</span> = pattern.search(line)<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>                insn_addr = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)<br>                target_addr = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>)<br>                br_map[insn_addr].add(target_addr)<br><br>    <span class="hljs-built_in">print</span>(br_map)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- 解析结果 (指令相对地址, 跳转相对地址) ---&quot;</span>)<br>    fixed_jumps = []<br><br>    <span class="hljs-keyword">for</span> insn_addr <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(br_map.keys(), key=<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">int</span>(x, <span class="hljs-number">16</span>)):<br>        targets = <span class="hljs-built_in">list</span>(br_map[insn_addr])<br>        <span class="hljs-comment"># 挑选出跳转地址固定的（即该指令地址对应的跳转目标只有一个）</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(targets) == <span class="hljs-number">1</span>:<br>            record = (<span class="hljs-built_in">eval</span>(<span class="hljs-string">f&quot;0x<span class="hljs-subst">&#123;insn_addr&#125;</span>&quot;</span>), <span class="hljs-built_in">eval</span>(<span class="hljs-string">f&quot;0x<span class="hljs-subst">&#123;targets[<span class="hljs-number">0</span>]&#125;</span>&quot;</span>))<br>            <span class="hljs-keyword">if</span> record[<span class="hljs-number">1</span>] &lt; <span class="hljs-number">0x100000000</span>:<br>                fixed_jumps.append(record)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(record[<span class="hljs-number">0</span>])&#125;</span> -&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(record[<span class="hljs-number">1</span>])&#125;</span>  [固定]&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;0x<span class="hljs-subst">&#123;insn_addr&#125;</span> -&gt; <span class="hljs-subst">&#123;targets&#125;</span> [动态/多变]&quot;</span>)<br><br>    <span class="hljs-keyword">return</span> fixed_jumps<br><br>fixed_results = parse_trace(<span class="hljs-string">&#x27;E:\LearningLibrary\FridaHook/frida-agent-example/frida-agent-example-main/agent\stalker_trace\libsgmainso.txt&#x27;</span>)<br><span class="hljs-built_in">print</span>(fixed_results)<br></code></pre></td></tr></table></figure>

<p>修复脚本如下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> struct<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">patch_so_file</span>(<span class="hljs-params">input_path, output_path, patch_list</span>):<br>    <span class="hljs-comment"># 读取原始文件</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        data = <span class="hljs-built_in">bytearray</span>(f.read())<br><br>    count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> insn_off, target_off <span class="hljs-keyword">in</span> patch_list:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 1. 计算 AArch64 B 指令的偏移量</span><br>            <span class="hljs-comment"># 公式: (target_addr - pc_addr) / 4</span><br>            diff = target_off - insn_off<br><br>            <span class="hljs-keyword">if</span> diff % <span class="hljs-number">4</span> != <span class="hljs-number">0</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[-] 跳过未对齐地址: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(insn_off)&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">continue</span><br><br>            <span class="hljs-comment"># 2. 构造 B 指令机器码</span><br>            <span class="hljs-comment"># B 指令高 6 位是 0x14 (000101)，低 26 位是 imm26</span><br>            imm26 = (diff // <span class="hljs-number">4</span>) &amp; <span class="hljs-number">0x03FFFFFF</span><br>            opcode = <span class="hljs-number">0x14000000</span> | imm26<br><br>            <span class="hljs-comment"># 3. 转为小端序字节 (AArch64 常用)</span><br>            patch_bytes = struct.pack(<span class="hljs-string">&quot;&lt;I&quot;</span>, opcode)<br><br>            <span class="hljs-comment"># 4. 物理替换字节</span><br>            <span class="hljs-comment"># 这里的 insn_off 必须是文件偏移 (File Offset)</span><br>            data[insn_off:insn_off + <span class="hljs-number">4</span>] = patch_bytes<br>            count += <span class="hljs-number">1</span><br>            <span class="hljs-comment"># print(f&quot;[+] Patched &#123;hex(insn_off)&#125; -&gt; B &#123;hex(target_off)&#125;&quot;)</span><br><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[-] 修复失败 <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(insn_off)&#125;</span>: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># 保存新文件</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_path, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(data)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n[***] 修补完成！&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[***] 原始文件: <span class="hljs-subst">&#123;input_path&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[***] 修复文件: <span class="hljs-subst">&#123;output_path&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[***] 共计修补处数: <span class="hljs-subst">&#123;count&#125;</span>&quot;</span>)<br><br>input_so = <span class="hljs-string">&quot;libsgmainso-6.6.231201.33656539.so&quot;</span>  <span class="hljs-comment"># 你的原始文件名</span><br>output_so = <span class="hljs-string">&quot;libsgmain_patched.so&quot;</span>  <span class="hljs-comment"># 修复后的文件名</span><br>patch_list =[(<span class="hljs-number">154608</span>, <span class="hljs-number">154632</span>), (<span class="hljs-number">154900</span>, <span class="hljs-number">154912</span>), (<span class="hljs-number">155060</span>, <span class="hljs-number">155084</span>), (<span class="hljs-number">155080</span>, <span class="hljs-number">155084</span>), (<span class="hljs-number">155152</span>, <span class="hljs-number">155156</span>), (<span class="hljs-number">155484</span>, <span class="hljs-number">155244</span>), (<span class="hljs-number">155572</span>, <span class="hljs-number">155596</span>), (<span class="hljs-number">164172</span>, <span class="hljs-number">164196</span>), (<span class="hljs-number">173844</span>, <span class="hljs-number">173868</span>), (<span class="hljs-number">174064</span>, <span class="hljs-number">174136</span>), (<span class="hljs-number">174224</span>, <span class="hljs-number">174296</span>), (<span class="hljs-number">299920</span>, <span class="hljs-number">299944</span>), (<span class="hljs-number">360316</span>, <span class="hljs-number">360344</span>), (<span class="hljs-number">360860</span>, <span class="hljs-number">360864</span>), (<span class="hljs-number">436780</span>, <span class="hljs-number">436804</span>), (<span class="hljs-number">437012</span>, <span class="hljs-number">437016</span>), (<span class="hljs-number">437040</span>, <span class="hljs-number">437044</span>), (<span class="hljs-number">437144</span>, <span class="hljs-number">437168</span>), (<span class="hljs-number">437352</span>, <span class="hljs-number">437356</span>), (<span class="hljs-number">437384</span>, <span class="hljs-number">437388</span>), (<span class="hljs-number">437428</span>, <span class="hljs-number">437432</span>), (<span class="hljs-number">437548</span>, <span class="hljs-number">437552</span>), (<span class="hljs-number">437704</span>, <span class="hljs-number">437708</span>), (<span class="hljs-number">444032</span>, <span class="hljs-number">444056</span>), (<span class="hljs-number">444188</span>, <span class="hljs-number">444208</span>), (<span class="hljs-number">459584</span>, <span class="hljs-number">459612</span>), (<span class="hljs-number">459904</span>, <span class="hljs-number">459932</span>), (<span class="hljs-number">895916</span>, <span class="hljs-number">895936</span>), (<span class="hljs-number">901408</span>, <span class="hljs-number">901432</span>), (<span class="hljs-number">901592</span>, <span class="hljs-number">901604</span>), (<span class="hljs-number">902536</span>, <span class="hljs-number">902564</span>), (<span class="hljs-number">903984</span>, <span class="hljs-number">903988</span>), (<span class="hljs-number">904260</span>, <span class="hljs-number">904264</span>), (<span class="hljs-number">904288</span>, <span class="hljs-number">904300</span>), (<span class="hljs-number">904420</span>, <span class="hljs-number">904432</span>), (<span class="hljs-number">905024</span>, <span class="hljs-number">905048</span>), (<span class="hljs-number">908824</span>, <span class="hljs-number">908852</span>), (<span class="hljs-number">909948</span>, <span class="hljs-number">909972</span>), (<span class="hljs-number">911608</span>, <span class="hljs-number">911632</span>), (<span class="hljs-number">1011988</span>, <span class="hljs-number">1012012</span>), (<span class="hljs-number">1055700</span>, <span class="hljs-number">1055724</span>), (<span class="hljs-number">1225092</span>, <span class="hljs-number">1225096</span>), (<span class="hljs-number">1226152</span>, <span class="hljs-number">1226172</span>), (<span class="hljs-number">1226372</span>, <span class="hljs-number">1226396</span>), (<span class="hljs-number">1230000</span>, <span class="hljs-number">1230028</span>), (<span class="hljs-number">1230980</span>, <span class="hljs-number">1231004</span>), (<span class="hljs-number">1231084</span>, <span class="hljs-number">1231112</span>), (<span class="hljs-number">1231476</span>, <span class="hljs-number">1231496</span>), (<span class="hljs-number">1232652</span>, <span class="hljs-number">1232676</span>), (<span class="hljs-number">1232884</span>, <span class="hljs-number">1232912</span>), (<span class="hljs-number">1243872</span>, <span class="hljs-number">1243896</span>), (<span class="hljs-number">1255964</span>, <span class="hljs-number">1256056</span>), (<span class="hljs-number">1256456</span>, <span class="hljs-number">1256056</span>), (<span class="hljs-number">1256512</span>, <span class="hljs-number">1256056</span>), (<span class="hljs-number">1256588</span>, <span class="hljs-number">1256056</span>), (<span class="hljs-number">1257016</span>, <span class="hljs-number">1256788</span>), (<span class="hljs-number">1257060</span>, <span class="hljs-number">1256788</span>), (<span class="hljs-number">1257748</span>, <span class="hljs-number">1258196</span>), (<span class="hljs-number">1258748</span>, <span class="hljs-number">1258028</span>), (<span class="hljs-number">1259644</span>, <span class="hljs-number">1257108</span>), (<span class="hljs-number">1259696</span>, <span class="hljs-number">1256700</span>), (<span class="hljs-number">1259852</span>, <span class="hljs-number">1258404</span>), (<span class="hljs-number">1260112</span>, <span class="hljs-number">1257616</span>), (<span class="hljs-number">1260424</span>, <span class="hljs-number">1258620</span>), (<span class="hljs-number">1260476</span>, <span class="hljs-number">1258404</span>), (<span class="hljs-number">1260528</span>, <span class="hljs-number">1257108</span>), (<span class="hljs-number">1260920</span>, <span class="hljs-number">1256700</span>), (<span class="hljs-number">1261448</span>, <span class="hljs-number">1258620</span>)]<br><br>patch_so_file(input_so, output_so, patch_list)<br></code></pre></td></tr></table></figure>

<p>然后再借助AI修复，最终展示效果如下：</p>
<p>!<img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101632789.png" srcset="/img/loading.gif" lazyload></p>
<p>其中<code>sub_25B78</code>是根据<code>cmdId</code>选取待执行的函数，<code>sub_109B94</code>则是抛<code>SecException</code>的地方。</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101633665.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="参数7012的确定"><a href="#参数7012的确定" class="headerlink" title="参数7012的确定"></a>参数7012的确定</h2><p>尝试打印doCommandNative的入参，发现该函数一直被调用，因此需要通过第一个参数进行过滤。如何寻找第一个参数呢，可以根据doCommandNative的调用堆栈</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus">hooked x-sgext <span class="hljs-selector-tag">header</span>: JBKuXHhu9np+<span class="hljs-number">9</span>obhAvi89FyfbJ9lnH+ca51lnX+cbI1/n2uYa5Zpnm2cbo1snGjPbJ5sn23PacpkzWqWf59qjW2cf5xsjWyebJl/mH+ff59/n3+ff59/n3+ff59/n3+ef55/nn+ef55/nn+ef405jWyNbI04nWTNbJx/nmyebJ5/nn+cOM9/nn+Nb41tjWyNb40m7w/Wf55/jnyfbI58n2+NaPFuiGqXepx6nnqXep56nnqXep96nnqeep96n2+dbZ5riA7EM/Fp8WyIbIhql2nIaJ49mXqeep56nnqeep56ngPPA5x6nnqeA59s8Q7/GfQT4B3BOeEa7x3sJM0a73eePfcX72zgc98VxhXvDp8GyRHsBO8d7AzjMvkVzy/ZGoEX6w3tH+s2yRbJF+<span class="hljs-number">8</span>D<br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Exception</span><br>        at java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.HashMap</span><span class="hljs-selector-class">.put</span>(Native Method)<br>        at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.wireless</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.adapter</span><span class="hljs-selector-class">.JNICLibrary</span><span class="hljs-selector-class">.doCommandNative</span>(Native Method)<br>        at com<span class="hljs-selector-class">.alibaba</span><span class="hljs-selector-class">.wireless</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.mainplugin</span>.б<span class="hljs-selector-class">.doCommand</span>(Unknown Source:<span class="hljs-number">0</span>)<br>        at com<span class="hljs-selector-class">.alibaba</span><span class="hljs-selector-class">.wireless</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.middletierplugin</span><span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.a</span><span class="hljs-selector-class">.a</span>(Unknown Source:<span class="hljs-number">370</span>)<br>        at com<span class="hljs-selector-class">.alibaba</span><span class="hljs-selector-class">.wireless</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.middletierplugin</span><span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.d</span>.a<span class="hljs-variable">$a</span><span class="hljs-selector-class">.invoke</span>(Unknown Source:<span class="hljs-number">56</span>)<br></code></pre></td></tr></table></figure>

<p><code>com.alibaba.wireless.security.middletierplugin.d.d.a.a</code>方法也不在apk中，通过定位确定在</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[+] 找到目标类: com.alibaba.wireless.security.middletierplugin.d.d.a<br>[+] 所在的 ClassLoader: dalvik.system.PathClassLoader[DexPathList[[zip <span class="hljs-keyword">file</span> <span class="hljs-string">&quot;/data/app/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/lib/arm64/libsgmiddletier.so&quot;</span>],nativeLibraryDirectories=[<span class="hljs-regexp">/data/</span>app<span class="hljs-regexp">/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/</span>lib<span class="hljs-regexp">/arm64, /</span>data<span class="hljs-regexp">/user/</span><span class="hljs-number">0</span><span class="hljs-regexp">/com.taobao.idlefish/</span>app_SGLib<span class="hljs-regexp">/app_1767620786/m</span>ain, <span class="hljs-regexp">/data/</span>app<span class="hljs-regexp">/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/</span>base.apk!<span class="hljs-regexp">/lib/</span>arm64-v8a, <span class="hljs-regexp">/system/</span>lib64, <span class="hljs-regexp">/vendor/</span>lib64, <span class="hljs-regexp">/system/</span>product/lib64]]]<br>[*] 搜索完毕。<br></code></pre></td></tr></table></figure>

<p><code>libsgmiddletier.so</code>其实是个<code>.jar</code>文件，对应方法如下</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101633077.png" srcset="/img/loading.gif" lazyload></p>
<p>可以确认第一个参数位70102</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">HookJavaDoCommandNative</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> targetClass = <span class="hljs-string">&quot;com.taobao.wireless.security.adapter.JNICLibrary&quot;</span>;<br>        <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">enumerateClassLoaders</span>(&#123;<br>            <span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">loader</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-keyword">if</span> (loader.<span class="hljs-title function_">findClass</span>(targetClass)) &#123;<br>                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] Find Loader: &quot;</span> + loader);<br>                        <span class="hljs-title class_">Java</span>.<span class="hljs-property">classFactory</span>.<span class="hljs-property">loader</span> = loader;<br>                        <span class="hljs-keyword">var</span> <span class="hljs-title class_">JNICLibrary</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-property">classFactory</span>.<span class="hljs-title function_">use</span>(targetClass);<br>                        <span class="hljs-title class_">JNICLibrary</span>[<span class="hljs-string">&quot;doCommandNative&quot;</span>].<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">i, objArr</span>) &#123;<br>                            <span class="hljs-keyword">var</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">doCommandNative</span>(i, objArr);<br>                            <span class="hljs-comment">//objectArr 可能是一个复杂对象，直接打印可能导致闪退</span><br>                            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">70102</span>) &#123;<br>                                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`&gt;&gt;&gt; doCommandNative is called: i=<span class="hljs-subst">$&#123;i&#125;</span>, objArr=<span class="hljs-subst">$&#123;objArr&#125;</span>`</span>);<br>                                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`&lt;&lt;&lt; doCommandNative result=<span class="hljs-subst">$&#123;result&#125;</span>`</span>);<br>                            &#125;<br>                            <span class="hljs-keyword">return</span> result;<br>                        &#125;;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">catch</span> (e) &#123;&#125;<br>            &#125;,<br>            <span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] 扫描结束&quot;</span>);<br>            &#125;<br>        &#125;);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>结果如下</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gradle">&gt;&gt;&gt; doCommandNative is called: i=<span class="hljs-number">70102</span>, objArr=<span class="hljs-number">21407387</span>,aVvA4IboYJQDAPf8FcEC0UhS&amp;&amp;&amp;<span class="hljs-number">21407387</span>&amp;a0fe5c4111c15cc20e9c7d1e435d1e4a&amp;<span class="hljs-number">1767857182</span>&amp;mtop.taobao.idlemtopsearch.search&amp;<span class="hljs-number">1.0</span>&amp;&amp;<span class="hljs-number">231200</span>@fleamarket_android_7.<span class="hljs-number">24.50</span>&amp;&amp;<span class="hljs-number">0</span>&amp;<span class="hljs-number">0</span>&amp;openappkey=DEFAULT_AUTH&amp;<span class="hljs-number">27</span>&amp;&amp;&amp;&amp;&amp;&amp;&amp;,<span class="hljs-keyword">false</span>,<span class="hljs-number">0</span>,mtop.taobao.idlemtopsearch.search,pageId=&amp;pageName=,,,,r_43,<span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>&lt;&lt;&lt; doCommandNative result=&#123;x-sgext=JBIPmr7PMNu4V0BAxFl6VZo+qj6jPbk9oj6uObk7qSy5Pq05rTevO6I6oiyqPa5uqj+qPqtur2uibKw3uTytLKs9uT2qLKo<span class="hljs-regexp">/qji5Obk+uT65Prk+uT65Prk+uTu5PLk/u</span>T+<span class="hljs-number">5</span>P7k<span class="hljs-regexp">/uT+5P7k/u</span>Sz<span class="hljs-regexp">/LKosqiz+PKJsqDm5P6o/</span>qj+<span class="hljs-number">5</span>P7k9<span class="hljs-regexp">/m65P7ksqSyrLKosqSzgTsl3uT+5L7o9ry+6PfssrlCoKaw2vD+8P7w9+ymoKagpqimpKagpqCmqKas6qDmrObxGznzFOsU/</span>vD+<span class="hljs-number">8</span>OaM6<span class="hljs-regexp">/Dr5Pq0pqimqKaopqimoKapQ+1CoKaopqlCrP8Vdy0rARNRO9UDLSctM2HffINskqm7LRNs/</span><span class="hljs-number">1</span>SD1SvJH212oVf1B2GHeIOJD12HDRvt87Um1RN9e2EzYZfNFw0TbUA==, x-umt=jAEBTQNLPJdxbAKbl3be2iObOyFNWQa4, x-mini-wua=apgQTv3ngf3j<span class="hljs-regexp">/rMtgf1ZEbk7ReAf+JR1ZAM+LqnVhu5pGFyL/</span>rrcRDeEjxsx5C7l7Il1tIELPiH8nVU<span class="hljs-regexp">/6Pmab/</span>sHcKlIK4Kl7XK89DkYj6H541kQtyAAYwoy4nPBpBDhg31Aw912N9ptRbI9+T/JPWqI7BA06ISJKTOsYAEUbQFRywhuvUlzd5zLhXLHaBUBljPA=, x-sign=azU7Bc002xAAJUfgcnMKiJ0rEvZ1VUflSUlCU9BHvC1fJVfxl9H0LDDzh8z+kioI5dz0V1Mw147Ev1ORFKQLUcaBwXVX5UflR8VH5U&#125;<br>&gt;&gt;&gt; doCommandNative is called: i=<span class="hljs-number">70102</span>, objArr=<span class="hljs-number">21407387</span>,aVvA4IboYJQDAPf8FcEC0UhS&amp;&amp;&amp;<span class="hljs-number">21407387</span>&amp;<span class="hljs-number">022</span>bc7b91aed2ac0e3f1d14f6d006ee5&amp;<span class="hljs-number">1767857182</span>&amp;mtop.taobao.idle.user.strategy.list&amp;<span class="hljs-number">1.0</span>&amp;&amp;<span class="hljs-number">231200</span>@fleamarket_android_7.<span class="hljs-number">24.50</span>&amp;&amp;<span class="hljs-number">0</span>&amp;<span class="hljs-number">0</span>&amp;openappkey=DEFAULT_AUTH&amp;<span class="hljs-number">27</span>&amp;&amp;&amp;&amp;&amp;&amp;&amp;,<span class="hljs-keyword">true</span>,<span class="hljs-number">0</span>,mtop.taobao.idle.user.strategy.list,pageId=&amp;pageName=,,,,r_44,<span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>&lt;&lt;&lt; doCommandNative result=&#123;x-sgext=JBKVKg5VgEEIzfDadMPKzyqkGqQTpwmnEqQeowmhHrYJpB2jHa0foRKgErYapx70GqUapBv0H<span class="hljs-regexp">/ES9hytCaYSthunCacathqlGqIJowmkCaQJpAmkCaQJpAmkCaEJpgmlCaUJpQmlCaUJpQmlCbZPthq2GrZOphL2GKMJpRqlGqUJpQmnTvQJpQm2GbYbthq2GbZQ1HntCaUJtQqnHLUKp0u2HsoYsxysDKUMowynSLMZsxmzGrMZsxizGLMasxugGKMbowzcfuZ1oHWlDKUMoxOgTKBJpE+zGrMasxqzGrMZsxvKS8oYsxqzGsobpXXHe9Bw3mTURdp703vWaO1vumu+GvR73mulZbpF0ELda8cYz03baPtuulLZZ/</span>tz3EvmXdMF3m<span class="hljs-regexp">/EaNZo/</span><span class="hljs-number">0</span>Pfc95ryg==, wua=gLpH_erlTs5FUBPOWxC1vj2YWpGJ1HxKPFDCu+mjzr1dhvwCdrN<span class="hljs-regexp">/aXUrIPOswGiA8P1l6JiMd89WUvOTD7UjQuJm4H1+lO+y3QNMtl+IYQYj5KuBTgJ7CiSznF+qsg82U9qdLIM1u2GzYekpt1k/</span>EorPIqh2P<span class="hljs-regexp">/gMy+3mCBk6P6wyVakyuEFUJr74WwuJyRHLeJO2bQeLikzrrS+/</span>OLi06lPs4P0J9YtyDNP7JVYQHjpYJdg5uWgGBwgoHCzK9r2aVMXSKh4s39iVifDszxWnq7RWg+<span class="hljs-number">94</span>CN5y7DqZdMMa<span class="hljs-regexp">/NtllTbD0UIgB35Cygq5hJ+spi1vsDSFO7SohEpMzR1nbAUB6N0mRtH7uTa7gO4Seu2O7KfE=, x-umt=jAEBTQNLPJdxbAKbl3be2iObOyFNWQa4, x-mini-wua=anwSMrS9rlDoyt8vwRcDpkQdKvyeQbjyi8c1APvzU6PB/</span>bBjb<span class="hljs-regexp">/8cB8b6ixqHseaZnDx1o4/</span>K9S2wgthmMNcWHTx5+yFA23ZuMBj+Fwmf2JjIsEm2GLcAIMXdSaP6+CD3y17fx9ozyqFtcwsCO0zNokfgzrkPvKcNUjlbs9K2os6i3qPnCmo5JhhuMDBpfUw+EgaI=, x-sign=azU7Bc002xAAIAnYRzvq5uz+fQg7EAnQB3wMZp5y8hgREBnE2eS6GX7Gyfmwp2Q9q+m6Yh0FmbuKih2kWpFFZIi0j0JJ0AnQCeAJ0A&#125;<br>&gt;&gt;&gt; doCommandNative is called: i=<span class="hljs-number">70102</span>, objArr=<span class="hljs-number">21407387</span>,aVvA4IboYJQDAPf8FcEC0UhS&amp;&amp;&amp;<span class="hljs-number">21407387</span>&amp;ecc151258314647b68b5710c0ac85fe7&amp;<span class="hljs-number">1767857343</span>&amp;mtop.idle.ad.expose&amp;<span class="hljs-number">1.0</span>&amp;&amp;<span class="hljs-number">231200</span>@fleamarket_android_7.<span class="hljs-number">24.50</span>&amp;&amp;<span class="hljs-number">0</span>&amp;<span class="hljs-number">0</span>&amp;openappkey=DEFAULT_AUTH&amp;<span class="hljs-number">27</span>&amp;&amp;&amp;&amp;&amp;&amp;&amp;,<span class="hljs-keyword">false</span>,<span class="hljs-number">0</span>,mtop.idle.ad.expose,pageId=&amp;pageName=,,,,r_45,<span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>&lt;&lt;&lt; doCommandNative result=&#123;x-sgext=JBKTweVTa0fjyxvcn8UhycGi8aL4oeKh+aL1peKn9LDioval9qv0p<span class="hljs-regexp">/mm+bDxofXy8aPxovDy9Pf58Per4qD4sPCh4qHxsPGj8aTipeKi4qLiouKi4qLiouKi4qbioOKj4qPio+Kj4qPio+Kj4rCksPGw8bCloPnw86Xio/G</span>j8aPio+KhpfLio+Kw8rDwsPGw8rC70pLr4qPis+Gh9rPhoaKw9czztfeq56Pno+ehorX1tfW18bX1tfK18rXxtfCm86XzoOerheCepp6j56Pnpfimp6aioqS18bXxtfG18bX1tfDMoMzztfC18czwo57BkNab1I<span class="hljs-regexp">/SpvKO1YDQgsGM0oC48fKY2rajj7yw8IPDpsHwyabfg/</span><span class="hljs-number">2</span>FvLndjP2S2qDgttXu2ITCg9CD+aDZpt6AzA==, x-umt=jAEBTQNLPJdxbAKbl3be2iObOyFNWQa4, x-mini-wua=azQTqjvZEAEx3f6eCKyWSxSd5KxzaRcQ5H58Q6tME10xt8RDbABgbrVx9z+k8pl2LxpjAxLyeJhZVLEcrBO3tns18ETrZis8IPGoXcDoAB5FRoy4T4tcNn8cCaoxf+Ob0Vv9PXz4S2pm9zB3GSIV4EaJaTLMbGvSK9Py7ym4x2yyqCnyUsoEp<span class="hljs-regexp">/BKclE73cM8TK/</span>c=, x-sign=azU7Bc002xAAJm6NH7se3vQq4QtcVm6GYCprMPkklU52Rn6SvrLdTxmQrq<span class="hljs-regexp">/X8QNrzL/</span>dNHpT<span class="hljs-regexp">/u3t3HryPcciMu/i</span>6BZulm6GbpZuhm&#125;<br></code></pre></td></tr></table></figure>

<p>生成的参数分别为：<code>x-sgext</code>、<code>x-umt</code>、<code>x-mini-wua</code>、<code>x-sign</code></p>
<h1 id="Unidbg模拟执行"><a href="#Unidbg模拟执行" class="headerlink" title="Unidbg模拟执行"></a>Unidbg模拟执行</h1><p>如果仅是简单直接的模拟执行<code>doCommandNative</code>方法，则回抛出SecExpection 701029904异常，通过网上查阅，发现该方法存在初始化函数。</p>
<h2 id="确定初始化函数"><a href="#确定初始化函数" class="headerlink" title="确定初始化函数"></a>确定初始化函数</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook_dlopen</span>(<span class="hljs-params">targetSoName</span>) &#123;<br>    <span class="hljs-keyword">const</span> funcName = <span class="hljs-string">&quot;android_dlopen_ext&quot;</span>;                  <span class="hljs-comment">// old version is &quot;dlopen&quot;, </span><br>    <span class="hljs-keyword">const</span> libc = <span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findBaseAddress</span>(<span class="hljs-string">&quot;libc.so&quot;</span>);<br>    <span class="hljs-keyword">var</span> funcPtr = <span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findExportByName</span>(<span class="hljs-literal">null</span>, funcName);  <span class="hljs-comment">// 查找导出函数 (null 代表搜索所有模块)</span><br><br>    <span class="hljs-keyword">if</span> (funcPtr) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[*] Hooking <span class="hljs-subst">$&#123;funcName&#125;</span> at libc.so!`</span>);<br>        <span class="hljs-comment">// hook dlopen</span><br>        <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(funcPtr, &#123;<br>            <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">args</span>) &#123;<br>                <span class="hljs-comment">// args[0] 是要加载的 SO 路径/文件名</span><br>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">path</span> = args[<span class="hljs-number">0</span>].<span class="hljs-title function_">readCString</span>();<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[*] 目标App尝试加载So文件: <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.path&#125;</span>`</span>);<br>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">shouldHook</span> = <span class="hljs-literal">false</span>;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">path</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">path</span>.<span class="hljs-title function_">indexOf</span>(targetSoName) &gt;= <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">shouldHook</span> = <span class="hljs-literal">true</span>;<br>                &#125;<br>            &#125;,<br>            <span class="hljs-attr">onLeave</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">retval</span>) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">shouldHook</span>) &#123;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[*] <span class="hljs-subst">$&#123;targetSoName&#125;</span> 加载完成，开始进行Hook操作...`</span>);<br>                    <span class="hljs-comment">// 在这里执行你想要的hook操作</span><br>                    <span class="hljs-title class_">HookTargetMethod</span>();<br>                &#125;<br>            &#125;<br>        &#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[-] Warning: &quot;</span> + funcName + <span class="hljs-string">&quot; not found in exports.&quot;</span>);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">// 寻找doCommandNative前置初始化工作(可能是由其他so完成的)</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">HookTargetMethod</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> targetClass = <span class="hljs-string">&quot;com.taobao.wireless.security.adapter.JNICLibrary&quot;</span>;<br><br>        <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">enumerateClassLoaders</span>(&#123;<br>            <span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">loader</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-keyword">if</span> (loader.<span class="hljs-title function_">findClass</span>(targetClass)) &#123;<br>                        <br>                        <span class="hljs-comment">// 局部化类工厂，避免污染全局</span><br>                        <span class="hljs-title class_">Java</span>.<span class="hljs-property">classFactory</span>.<span class="hljs-property">loader</span> = loader;<br>                        <span class="hljs-keyword">var</span> <span class="hljs-title class_">JNICLibrary</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-property">classFactory</span>.<span class="hljs-title function_">use</span>(targetClass); <br><br>                        <span class="hljs-title class_">JNICLibrary</span>[<span class="hljs-string">&quot;doCommandNative&quot;</span>].<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">i, objArr</span>) &#123;<br>                            <span class="hljs-keyword">var</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">doCommandNative</span>(i, objArr);<br>                            <span class="hljs-comment">//objectArr 可能是一个复杂对象，直接打印可能导致闪退</span><br>                            <span class="hljs-keyword">var</span> stackTrace = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.util.Log&quot;</span>).<span class="hljs-title function_">getStackTraceString</span>(<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;java.lang.Exception&quot;</span>).$new());<br>                            <span class="hljs-keyword">var</span> objArrStr = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;java.util.Arrays&quot;</span>).<span class="hljs-title function_">toString</span>(objArr);<br>                            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`&gt;&gt;&gt; doCommandNative is called: cmdId=<span class="hljs-subst">$&#123;i&#125;</span>, objArr=<span class="hljs-subst">$&#123;objArrStr&#125;</span>\n&lt;&lt;&lt; doCommandNative result=<span class="hljs-subst">$&#123;result&#125;</span>\n<span class="hljs-subst">$&#123;stackTrace&#125;</span>`</span>);<br>                            <span class="hljs-keyword">return</span> result;<br>                        &#125;;<br>                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Hook doCommandNative函数完毕&quot;</span>);<br>                    &#125;<br>                &#125; <span class="hljs-keyword">catch</span> (e) &#123;&#125;<br>            &#125;,<br>            <span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;&#125;<br>        &#125;);<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// Hook the target SO file</span><br>    <span class="hljs-comment">// 不能通过libsgmain.so判定，因为它本质上是个jar包，不通过dlopen加载</span><br>    <span class="hljs-title function_">hook_dlopen</span>(<span class="hljs-string">&quot;libsgmainso-6.6.231201.33656539.so&quot;</span>);<br>&#125;<br><br><br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure>

<p>部分打印如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><code class="hljs shell">...<br>[*] 目标App尝试加载So文件: /data/app/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/lib/arm64/libc++_shared.so<br>[*] 目标App尝试加载So文件: /data/app/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/lib/arm64/libAliHALogEngine.so<br>[*] 目标App尝试加载So文件: /data/app/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/lib/arm64/libsgmainso-6.6.231201.33656539.so<br>[*] libsgmainso-6.6.231201.33656539.so 加载完成，开始进行Hook操作...<br>[*] Hook doCommandNative函数完毕<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; doCommandNative is called: cmdId=10101, objArr=[com.taobao.idlefish.TaoBaoApplication@9bd6cea, 3, , /data/user/0/com.taobao.idlefish/app_SGLib, , com.taobao.idlefish, 7.24.50, 10, com.taobao.idlefish, 0]</span><br>&lt;&lt;&lt; doCommandNative result=0<br>java.lang.Exception<br>        at com.taobao.wireless.security.adapter.JNICLibrary.doCommandNative(Native Method)<br>        at com.alibaba.wireless.security.mainplugin.б.doCommand(Unknown Source:0)<br>        at com.alibaba.wireless.security.mainplugin.SecurityGuardMainPlugin.onPluginLoaded(Unknown Source:264)<br>        at com.alibaba.wireless.security.framework.d.a(:11)<br>        at com.alibaba.wireless.security.framework.d.c(:1)<br>        at com.alibaba.wireless.security.framework.d.getPluginInfo(:30)<br>        at com.alibaba.wireless.security.open.initialize.b.b(:1)<br>        at com.alibaba.wireless.security.open.initialize.a.loadLibrarySync(:2)<br>        at com.alibaba.wireless.security.open.initialize.a.loadLibrarySync(:1)<br>        at com.alibaba.wireless.security.open.initialize.a.initialize(:1)<br>        at com.taobao.wireless.security.sdk.initialize.a.initialize(:5)<br>        at com.taobao.idlefish.init.SecurityGuardInitConfig.initSecurity(SecurityGuardInitConfig.java:9)<br>        at com.idlefish.blink.BlinkNodeNewJoint.com_taobao_idlefish_init_SecurityGuardInitConfig_initSecurity_main(BlinkNodeNewJoint.java:1)<br>        at com.idlefish.blink.BlinkNodeNewJoint.execNodeByName(BlinkNodeNewJoint.java:1)<br>        at com.taobao.idlefish.launcher.startup.blink.NodeExecutor.execNewNodeByName(NodeExecutor.java:1)<br>        at com.taobao.idlefish.launcher.startup.blinknew.BlinkNewEngine.execNode(BlinkNewEngine.java:39)<br>        at com.taobao.idlefish.launcher.startup.blinknew.BlinkNewEngine.access$300(BlinkNewEngine.java:1)<br>        at com.taobao.idlefish.launcher.startup.blinknew.BlinkNewEngine$ParallelSyncRun.execRun(BlinkNewEngine.java:252)<br>        at com.taobao.idlefish.launcher.startup.blinknew.BlinkNewEngine$ParallelSyncRun.access$000(BlinkNewEngine.java:2)<br>        at com.taobao.idlefish.launcher.startup.blinknew.BlinkNewEngine.execParallelSync(BlinkNewEngine.java:167)<br>        at com.taobao.idlefish.launcher.startup.blinknew.FishNewBlink.now(FishNewBlink.java:17)<br>        at com.taobao.idlefish.launcher.startup.blinknew.FishNewBlink.prepare(FishNewBlink.java:86)<br>        at com.taobao.idlefish.startup.process.MainProcess.onCreate(MainProcess.java:133)<br>        at com.taobao.idlefish.launcher.startup.process.FishProcess.instance(FishProcess.java:20)<br>        at com.taobao.idlefish.TaoBaoApplication.initFishProcess(TaoBaoApplication.java:54)<br>        at com.taobao.idlefish.TaoBaoApplication.newLaunch(TaoBaoApplication.java:34)<br>        at com.taobao.idlefish.TaoBaoApplication.onCreate(TaoBaoApplication.java:44)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; doCommandNative is called: cmdId=10102, objArr=[main, 6.6.231201.33656539, /data/app/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/lib/arm64/libsgmainso-6.6.231201.33656539.so]</span><br>&lt;&lt;&lt; doCommandNative result=0<br>java.lang.Exception<br>        at com.taobao.wireless.security.adapter.JNICLibrary.doCommandNative(Native Method)<br>        at com.alibaba.wireless.security.mainplugin.б.doCommand(Unknown Source:0)<br>        at com.alibaba.wireless.security.framework.d.a(:11)<br>        at com.alibaba.wireless.security.framework.d.c(:1)<br>        at com.alibaba.wireless.security.framework.d.getPluginInfo(:30)<br>        at com.alibaba.wireless.security.open.initialize.b.b(:1)<br>        at com.alibaba.wireless.security.open.initialize.a.loadLibrarySync(:2)<br>        at com.alibaba.wireless.security.open.initialize.a.loadLibrarySync(:1)<br>        at com.alibaba.wireless.security.open.initialize.a.initialize(:1)<br>        at com.taobao.wireless.security.sdk.initialize.a.initialize(:5)<br>        at com.taobao.idlefish.init.SecurityGuardInitConfig.initSecurity(SecurityGuardInitConfig.java:9)<br>        at com.idlefish.blink.BlinkNodeNewJoint.com_taobao_idlefish_init_SecurityGuardInitConfig_initSecurity_main(BlinkNodeNewJoint.java:1)<br>        at com.idlefish.blink.BlinkNodeNewJoint.execNodeByName(BlinkNodeNewJoint.java:1)<br>        at com.taobao.idlefish.launcher.startup.blink.NodeExecutor.execNewNodeByName(NodeExecutor.java:1)<br>        at com.taobao.idlefish.launcher.startup.blinknew.BlinkNewEngine.execNode(BlinkNewEngine.java:39)<br>        at com.taobao.idlefish.launcher.startup.blinknew.BlinkNewEngine.access$300(BlinkNewEngine.java:1)<br>        at com.taobao.idlefish.launcher.startup.blinknew.BlinkNewEngine$ParallelSyncRun.execRun(BlinkNewEngine.java:252)<br>        at com.taobao.idlefish.launcher.startup.blinknew.BlinkNewEngine$ParallelSyncRun.access$000(BlinkNewEngine.java:2)<br>        at com.taobao.idlefish.launcher.startup.blinknew.BlinkNewEngine.execParallelSync(BlinkNewEngine.java:167)<br>        at com.taobao.idlefish.launcher.startup.blinknew.FishNewBlink.now(FishNewBlink.java:17)<br>        at com.taobao.idlefish.launcher.startup.blinknew.FishNewBlink.prepare(FishNewBlink.java:86)<br>        at com.taobao.idlefish.startup.process.MainProcess.onCreate(MainProcess.java:133)<br>        at com.taobao.idlefish.launcher.startup.process.FishProcess.instance(FishProcess.java:20)<br>        at com.taobao.idlefish.TaoBaoApplication.initFishProcess(TaoBaoApplication.java:54)<br>        at com.taobao.idlefish.TaoBaoApplication.newLaunch(TaoBaoApplication.java:34)<br>        at com.taobao.idlefish.TaoBaoApplication.onCreate(TaoBaoApplication.java:44)<br>        <br>[*] 目标App尝试加载So文件: /data/app/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/lib/arm64/libsgsecuritybodyso-6.6.231201.33656539.so<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; doCommandNative is called: cmdId=10603, objArr=[database_encrypt, ]</span><br>&lt;&lt;&lt; doCommandNative result=8327dcfe97ed27ebb0a60c3f72835237<br>java.lang.Exception<br>        at com.taobao.wireless.security.adapter.JNICLibrary.doCommandNative(Native Method)<br>        at com.alibaba.wireless.security.mainplugin.б.doCommand(Unknown Source:0)<br>        at а.а.а.а.а.й.а.getExtraData(Unknown Source:17)<br>        at а.б.а.а.а.ж.а.getExtraData(Unknown Source:4)<br>        at com.taobao.idlefish.storage.datacenter.DataCenterModule.getEncryptedPassword(DataCenterModule.java:30)<br>        at com.taobao.idlefish.storage.datacenter.DataCenterModule$1.run(DataCenterModule.java:27)<br>		...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; doCommandNative is called: cmdId=10401, objArr=[&#123;INPUT=2&amp;reg025RcAN4v7raOUlN1xjvN0BDXA0TY&amp;21407387&amp;1&#125;, 21407387, 3, , <span class="hljs-literal">true</span>]</span><br>&lt;&lt;&lt; doCommandNative result=8f560ed89a67e05aa77eeca4c69e588ddd99e939<br>java.lang.Exception<br>        at com.taobao.wireless.security.adapter.JNICLibrary.doCommandNative(Native Method)<br>        at com.alibaba.wireless.security.mainplugin.б.doCommand(Unknown Source:0)<br>        at а.а.а.а.а.з.а.signRequest(Unknown Source:115)<br>        at com.taobao.accs.utl.UtilityImpl.getAppsign(UtilityImpl.java:205)<br>        at com.taobao.accs.data.Message.buildBindApp(Message.java:24)<br>        at com.taobao.accs.data.Message.buildBindApp(Message.java:6)<br>        at com.taobao.accs.data.MessageV2.buildBindApp(MessageV2.java:1)<br>        at com.taobao.accs.internal.ACCSManagerImpl.bindApp(ACCSManagerImpl.java:27)<br>        at com.taobao.agoo.TaobaoRegister.register(TaobaoRegister.java:22)<br>        at com.taobao.fleamarket.PushConfigerNew$6.run(PushConfigerNew.java:40)<br>        at com.taobao.idlefish.launcher.startup.async.AsyncMaybeHandler$2.run(AsyncMaybeHandler.java:3)<br>		...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; doCommandNative is called: cmdId=10102, objArr=[securitybody, 6.6.231201.33656539, /data/app/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/lib/arm64/libsgsecuritybodyso-6.6.231201.33656539.so]</span><br>&lt;&lt;&lt; doCommandNative result=0<br>java.lang.Exception<br>        at com.taobao.wireless.security.adapter.JNICLibrary.doCommandNative(Native Method)<br>        at com.alibaba.wireless.security.mainplugin.б.doCommand(Unknown Source:0)<br>        at com.alibaba.wireless.security.framework.d.a(:11)<br>        at com.alibaba.wireless.security.framework.d.c(:1)<br>        at com.alibaba.wireless.security.framework.d.getPluginInfo(:30)<br>        at com.alibaba.wireless.security.framework.d.a(Unknown Source:62)<br>        at com.alibaba.wireless.security.framework.d.b(:17)<br>        at com.alibaba.wireless.security.framework.d.getInterface(:10)<br>        at com.alibaba.wireless.security.open.SecurityGuardManager.getInterface(:3)<br>        at com.alibaba.wireless.security.open.SecurityGuardManager.a(:13)<br>        at com.alibaba.wireless.security.open.SecurityGuardManager.getUMIDComp(:3)<br>        at com.ali.user.mobile.info.AppInfo.generateUmidToken(AppInfo.java:56)<br>        at com.ali.user.mobile.info.AppInfo.init(AppInfo.java:166)<br>        at com.ali.user.mobile.app.init.AliUserInit.init(AliUserInit.java:56)<br>        at com.taobao.login4android.login.LoginController.initAliuserSDK(LoginController.java:51)<br>        at com.taobao.login4android.Login$1.run(Login.java:17)<br>		...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; doCommandNative is called: cmdId=22302, objArr=[0, <span class="hljs-literal">true</span>]</span><br>&lt;&lt;&lt; doCommandNative result=dfMBm6xLPFZHRwKbpi+ykNIL61XgNNHE<br>java.lang.Exception<br>        at com.taobao.wireless.security.adapter.JNICLibrary.doCommandNative(Native Method)<br>        at com.alibaba.wireless.security.mainplugin.б.doCommand(Unknown Source:0)<br>        at com.taobao.dp.DeviceSecuritySDKImpl.getSecurityTokenNative(Unknown Source:25)<br>        at com.taobao.dp.DeviceSecuritySDKImpl.getSecurityToken(Unknown Source:0)<br>        at com.alibaba.wireless.security.open.umid.UMIDComponent.getSecurityToken(Unknown Source:13)<br>        at com.taobao.accs.data.MessageV2.getUmidToken(MessageV2.java:18)<br>        at com.taobao.accs.data.MessageV2.buildBindApp(MessageV2.java:54)<br>        at com.taobao.accs.internal.ACCSManagerImpl.bindApp(ACCSManagerImpl.java:27)<br>        at com.taobao.agoo.TaobaoRegister.register(TaobaoRegister.java:22)<br>        at com.taobao.fleamarket.PushConfigerNew$6.run(PushConfigerNew.java:40)<br>        at com.taobao.idlefish.launcher.startup.async.AsyncMaybeHandler$2.run(AsyncMaybeHandler.java:3)<br>		...<br><br>[*] 目标App尝试加载So文件: /data/app/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/lib/arm64/libsgmiddletierso-6.6.231201.33656539.so<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; doCommandNative is called: cmdId=10102, objArr=[middletier, 6.6.231201.33656539, /data/app/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/lib/arm64/libsgmiddletierso-6.6.231201.33656539.so]</span><br>&lt;&lt;&lt; doCommandNative result=0<br>java.lang.Exception<br>        at com.taobao.wireless.security.adapter.JNICLibrary.doCommandNative(Native Method)<br>        at com.alibaba.wireless.security.mainplugin.б.doCommand(Unknown Source:0)<br>        at com.alibaba.wireless.security.framework.d.a(:11)<br>        at com.alibaba.wireless.security.framework.d.c(:1)<br>        at com.alibaba.wireless.security.framework.d.getPluginInfo(:30)<br>        at com.alibaba.wireless.security.framework.d.a(Unknown Source:62)<br>        at com.alibaba.wireless.security.framework.d.b(:17)<br>        at com.alibaba.wireless.security.framework.d.getInterface(:10)<br>        at com.alibaba.wireless.security.open.SecurityGuardManager.getInterface(:3)<br>        at mtopsdk.security.InnerSignImpl.initMiddleTier(InnerSignImpl.java:46)<br>        at mtopsdk.security.InnerSignImpl.init(InnerSignImpl.java:79)<br>        at mtopsdk.mtop.global.init.InnerMtopInitTask.executeSignTask(InnerMtopInitTask.java:10)<br>        at mtopsdk.mtop.intf.Mtop$1.run(Mtop.java:28)<br>        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:462)<br>        at java.util.concurrent.FutureTask.run(FutureTask.java:266)<br>        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)<br>        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)<br>        at java.lang.Thread.run(Thread.java:919)<br>        at mtopsdk.mtop.util.MtopSDKThreadPoolExecutorFactory$MtopSDKThreadFactory$1.run(MtopSDKThreadPoolExecutorFactory.java:22)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; doCommandNative is called: cmdId=10401, objArr=[&#123;INPUT=2&amp;reg025RcAN4v7raOUlN1xjvN0BDXA0TY&amp;21407387&amp;1&#125;, 21407387, 3, , <span class="hljs-literal">true</span>]</span><br>&lt;&lt;&lt; doCommandNative result=8f560ed89a67e05aa77eeca4c69e588ddd99e939<br>java.lang.Exception<br>        at com.taobao.wireless.security.adapter.JNICLibrary.doCommandNative(Native Method)<br>        at com.alibaba.wireless.security.mainplugin.б.doCommand(Unknown Source:0)<br>        at а.а.а.а.а.з.а.signRequest(Unknown Source:115)<br>        at com.taobao.accs.utl.UtilityImpl.getAppsign(UtilityImpl.java:205)<br>        at com.taobao.accs.data.Message.buildBindApp(Message.java:24)<br>        at com.taobao.accs.data.Message.buildBindApp(Message.java:6)<br>        at com.taobao.accs.data.MessageV2.buildBindApp(MessageV2.java:1)<br>        at com.taobao.accs.internal.ACCSManagerImpl.bindApp(ACCSManagerImpl.java:27)<br>        at com.taobao.agoo.TaobaoRegister.register(TaobaoRegister.java:22)<br>        at com.taobao.fleamarket.PushConfigerNew$6.run(PushConfigerNew.java:40)<br>        at com.taobao.idlefish.launcher.startup.async.AsyncMaybeHandler$2.run(AsyncMaybeHandler.java:3)<br>		...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; doCommandNative is called: cmdId=70201, objArr=[mwua, sgcipher]</span><br>&lt;&lt;&lt; doCommandNative result=538233707333<br>java.lang.Exception<br>        at com.taobao.wireless.security.adapter.JNICLibrary.doCommandNative(Native Method)<br>        at com.alibaba.wireless.security.mainplugin.б.doCommand(Unknown Source:0)<br>        at com.alibaba.wireless.security.middletierplugin.d.a.a$a.a(Unknown Source:18)<br>        at com.alibaba.wireless.security.middletierplugin.d.a.a.createAVMPInstance(Unknown Source:7)<br>        at mtopsdk.security.InnerSignImpl.getAVMPInstance(InnerSignImpl.java:28)<br>        at mtopsdk.security.InnerSignImpl$1.run(InnerSignImpl.java:5)<br>        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:462)<br>        at java.util.concurrent.FutureTask.run(FutureTask.java:266)<br>        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)<br>        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)<br>        at java.lang.Thread.run(Thread.java:919)<br>        at mtopsdk.mtop.util.MtopSDKThreadPoolExecutorFactory$MtopSDKThreadFactory$1.run(MtopSDKThreadPoolExecutorFactory.java:22)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; doCommandNative is called: cmdId=70102, objArr=[21407387, aVvA4IboYJQDAPf8FcEC0UhS&amp;&amp;&amp;21407387&amp;99914b932bd37a50b983c5e7c90ae93b&amp;1768188810&amp;mtop.common.gettimestamp&amp;*&amp;&amp;231200@fleamarket_android_7.24.50&amp;&amp;&amp;&amp;openappkey=DEFAULT_AUTH&amp;27&amp;&amp;&amp;&amp;&amp;&amp;&amp;, <span class="hljs-literal">false</span>, 0, mtop.common.gettimestamp, pageId=&amp;pageName=, null, null, null, r_1, 0, 0]</span><br>&lt;&lt;&lt; doCommandNative result=&#123;x-sgext=JBJnkbWnO7OzP0sozzFxPZFWoVaoVbJVqVWnX7JWskSgUKdfoF+pX6BXslehV6FXoVehV6FXoVehV6FEpUShRKFXslehV6FEoUSgRKBEoESgRKBEoEShRKFEoUShRKFEoUShRKFEoUShRLJVsleyV7JXoVehV6FEoVehV6FEoUSjA/BEoUSyVLJQsleyVLId0DTpRKFEsUexV7FHsVeyU85Vt1GoQaNBp16nU6cFqQa3V7dXt1e3V7dXt1e3V7dXtzikOKFBoUGnXqdTpwWpBrdXt1e3V7dXt1e3V84=, x-umt=dfMBm6xLPFZHRwKbpi+ykNIL61XgNNHE, x-mini-wua=a5QSJaFb6JyAMD8KRrjBIJ6IMflm0VTDhzMmsR7IcenIBDQ5d1ZAyfEqKTDv7Y7Hah32lCKXwue9Ls5xrMn1p6vlVkk8lSimJ3VCMrYJOvU2CBks/Iz4k1WKxOzXWebgRVdLtFQXFEVb9WKv+mf6Y/pj+7OXCcGbuTQiY6bLS3a9CR6nIutIbEEab9NptKlZV58Q=, x-sign=azU7Bc002xAALL5pey3MnakNw8fufL5ssMC72inORaSpM451BKgNqdoYzkUEDkVFs0wA2eBv83D9NqoY7S3y2D8IOPy+fL5svny+bL&#125; <br>java.lang.Exception<br>        at com.taobao.wireless.security.adapter.JNICLibrary.doCommandNative(Native Method)<br>        at com.alibaba.wireless.security.mainplugin.б.doCommand(Unknown Source:0)<br>        at com.alibaba.wireless.security.middletierplugin.d.d.a.a(Unknown Source:370)<br>        at com.alibaba.wireless.security.middletierplugin.d.d.a$a.invoke(Unknown Source:56)<br>        at java.lang.reflect.Proxy.invoke(Proxy.java:1006)<br>        at $Proxy31.getSecurityFactors(Unknown Source)<br>        at mtopsdk.security.InnerSignImpl.getUnifiedSign(InnerSignImpl.java:299)<br>        at mtopsdk.mtop.protocol.builder.impl.InnerProtocolParamBuilderImpl.buildParams(InnerProtocolParamBuilderImpl.java:853)<br>        at mtopsdk.framework.filter.before.ProtocolParamBuilderBeforeFilter.doBefore(ProtocolParamBuilderBeforeFilter.java:6)<br>        at mtopsdk.framework.manager.impl.AbstractFilterManager.start(AbstractFilterManager.java:62)<br>        at mtopsdk.mtop.intf.MtopBuilder$1.run(MtopBuilder.java:56)<br>        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:462)<br>        at java.util.concurrent.FutureTask.run(FutureTask.java:266)<br>        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)<br>        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)<br>        at java.lang.Thread.run(Thread.java:919)<br>        at mtopsdk.mtop.util.MtopSDKThreadPoolExecutorFactory$MtopSDKThreadFactory$1.run(MtopSDKThreadPoolExecutorFactory.java:22)<br></code></pre></td></tr></table></figure>

<p>提取关键方法如下：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">&gt;&gt;&gt; doCommandNative is called: cmdId=<span class="hljs-number">10101</span>, objArr=[com.taobao.idlefish.TaoBaoApplication@<span class="hljs-number">9</span>bd6cea, <span class="hljs-number">3</span>, , <span class="hljs-regexp">/data/u</span>ser<span class="hljs-regexp">/0/</span>com.taobao.idlefish/app_SGLib, , com.taobao.idlefish, <span class="hljs-number">7.24</span>.<span class="hljs-number">50</span>, <span class="hljs-number">10</span>, com.taobao.idlefish, <span class="hljs-number">0</span>]<br>&gt;&gt;&gt; doCommandNative is called: cmdId=<span class="hljs-number">10102</span>, objArr=[main, <span class="hljs-number">6.6</span>.<span class="hljs-number">231201.33656539</span>, <span class="hljs-regexp">/data/</span>app<span class="hljs-regexp">/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/</span>lib<span class="hljs-regexp">/arm64/</span>libsgmainso-<span class="hljs-number">6.6</span>.<span class="hljs-number">231201.33656539</span>.so]<br>&gt;&gt;&gt; doCommandNative is called: cmdId=<span class="hljs-number">10102</span>, objArr=[securitybody, <span class="hljs-number">6.6</span>.<span class="hljs-number">231201.33656539</span>, <span class="hljs-regexp">/data/</span>app<span class="hljs-regexp">/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/</span>lib<span class="hljs-regexp">/arm64/</span>libsgsecuritybodyso-<span class="hljs-number">6.6</span>.<span class="hljs-number">231201.33656539</span>.so]<br>&gt;&gt;&gt; doCommandNative is called: cmdId=<span class="hljs-number">10102</span>, objArr=[middletier, <span class="hljs-number">6.6</span>.<span class="hljs-number">231201.33656539</span>, <span class="hljs-regexp">/data/</span>app<span class="hljs-regexp">/com.taobao.idlefish-ZzE5UcLUySRXY_Pap1bAyQ==/</span>lib<span class="hljs-regexp">/arm64/</span>libsgmiddletierso-<span class="hljs-number">6.6</span>.<span class="hljs-number">231201.33656539</span>.so]<br></code></pre></td></tr></table></figure>

<p>按顺序依次调用<code>doCommandNative</code>，最后调用<code>doCommandNative</code>生成<code>x-</code>系列参数。</p>
<h2 id="Unidbg补环境"><a href="#Unidbg补环境" class="headerlink" title="Unidbg补环境"></a>Unidbg补环境</h2><p>初始代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">package</span> com.taobao.idlefish;<br><br><span class="hljs-keyword">import</span> com.github.unidbg.AndroidEmulator;<br><span class="hljs-keyword">import</span> com.github.unidbg.Emulator;<br><span class="hljs-keyword">import</span> com.github.unidbg.Module;<br><span class="hljs-keyword">import</span> com.github.unidbg.arm.backend.Unicorn2Factory;<br><span class="hljs-keyword">import</span> com.github.unidbg.debugger.Debugger;<br><span class="hljs-keyword">import</span> com.github.unidbg.debugger.FunctionCallListener;<br><span class="hljs-keyword">import</span> com.github.unidbg.file.FileResult;<br><span class="hljs-keyword">import</span> com.github.unidbg.file.IOResolver;<br><span class="hljs-keyword">import</span> com.github.unidbg.file.linux.AndroidFileIO;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.ARM64SyscallHandler;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.AndroidSyscallHandler;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.android.AndroidARM64Emulator;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.android.dvm.*;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.android.dvm.api.ApplicationInfo;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.android.dvm.api.ClassLoader;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.android.dvm.array.ArrayObject;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.android.dvm.wrapper.DvmBoolean;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.android.dvm.wrapper.DvmInteger;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.file.DirectoryFileIO;<br><span class="hljs-keyword">import</span> com.github.unidbg.linux.file.SimpleFileIO;<br><span class="hljs-keyword">import</span> com.github.unidbg.memory.Memory;<br><span class="hljs-keyword">import</span> com.github.unidbg.memory.SvcMemory;<br><span class="hljs-keyword">import</span> com.github.unidbg.pointer.UnidbgPointer;<br><span class="hljs-keyword">import</span> com.github.unidbg.unix.UnixSyscallHandler;<br><span class="hljs-keyword">import</span> com.github.unidbg.virtualmodule.android.AndroidModule;<br><span class="hljs-keyword">import</span> com.shopee.Shpssdk;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.util.logging.Level;<br><span class="hljs-keyword">import</span> java.util.logging.Logger;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNICLibrary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MyAbstractJni</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AndroidEmulator emulator;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Memory memory;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> VM vm;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Module <span class="hljs-keyword">module</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DvmClass JNICLibraryClzz;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JNICLibrary</span><span class="hljs-params">()</span>&#123;<br>        emulator = AndroidEmulatorBuilder<br>                .for64Bit()<br>                .addBackendFactory(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Unicorn2Factory</span>(<span class="hljs-literal">true</span>))<br>                .setProcessName(<span class="hljs-string">&quot;com.taobao.idlefish&quot;</span>)<br>                .setRootDir(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;unidbg-android/src/test/resources/xianyu/rootfs&quot;</span>))<br>                .build();<br><br>        emulator.getSyscallHandler().setVerbose(<span class="hljs-literal">true</span>);<br><br>        memory = emulator.getMemory();<br>        memory.setLibraryResolver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AndroidResolver</span>(<span class="hljs-number">23</span>));<br><br>        <span class="hljs-comment">//加载apk</span><br>        vm = emulator.createDalvikVM(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;unidbg-android/src/test/resources/xianyu/xianyu.apk&quot;</span>));<br>        vm.setJni(<span class="hljs-built_in">this</span>);<br>        vm.setVerbose(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-comment">// 使用 libandroid.so 虚拟模块, 需早于目标 SO 加载的时机</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AndroidModule</span>(emulator, vm).register(memory);<br>        <span class="hljs-comment">// 加载目标库</span><br>        <span class="hljs-type">DalvikModule</span> <span class="hljs-variable">dm</span> <span class="hljs-operator">=</span> vm.loadLibrary(<span class="hljs-string">&quot;sgmainso-6.6.231201.33656539&quot;</span>, <span class="hljs-literal">true</span>);<br>        <span class="hljs-keyword">module</span> = dm.getModule();<br><br>        JNICLibraryClzz = vm.resolveClass(<span class="hljs-string">&quot;com.taobao.wireless.security.adapter.JNICLibrary&quot;</span>);<br>        <span class="hljs-comment">// 手动执行JNI_OnLoad函数</span><br>        dm.callJNI_OnLoad(emulator);<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">calldoCommandNative</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 10101 app_SGLib</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">cmdId1</span> <span class="hljs-operator">=</span> <span class="hljs-number">10101</span>;<br>        <span class="hljs-type">ArrayObject</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayObject</span>(<br>                vm.resolveClass(<span class="hljs-string">&quot;com.taobao.idlefish.TaoBaoApplication&quot;</span>).newObject(<span class="hljs-literal">null</span>),<br>                DvmInteger.valueOf(vm,<span class="hljs-number">3</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;/data/user/0/com.taobao.idlefish/app_SGLib&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;com.taobao.idlefish&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;7.24.50&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;10&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;com.taobao.idlefish&quot;</span>),<br>                DvmInteger.valueOf(vm, <span class="hljs-number">0</span>)<br>        );<br>        System.out.println(<span class="hljs-string">&quot;[+] ---------------------------------- 10101 app_SGLib --------------------------------&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result1</span> <span class="hljs-operator">=</span> JNICLibraryClzz.callStaticJniMethodObject(emulator,<br>                        <span class="hljs-string">&quot;doCommandNative(I[Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>,<br>                        cmdId1,  obj1)<br>                .getValue().toString();<br>        System.out.println(<span class="hljs-string">&quot;[+] app_SGLib init, result: &quot;</span> + result1);<br><br>        <span class="hljs-comment">// 10102 libsgmainso-6.6.231201.33656539.so</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">cmdId2</span> <span class="hljs-operator">=</span> <span class="hljs-number">10102</span>;<br>        <span class="hljs-type">ArrayObject</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayObject</span>(<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;main&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;6.6.231201.33656539&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;/data/app/com.taobao.idlefish-Mk5qkEh32zCm7x9fbp9IBw==/lib/arm64/libsgmainso-6.6.231201.33656539.so&quot;</span>)<br>        );<br>        System.out.println(<span class="hljs-string">&quot;[+] ---------------------------------- 10102 libsgmainso-6.6.231201.33656539.so --------------------------------&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result2</span> <span class="hljs-operator">=</span> JNICLibraryClzz.callStaticJniMethodObject(emulator,<br>                        <span class="hljs-string">&quot;doCommandNative(I[Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>,<br>                        cmdId2, obj2)<br>                .getValue().toString();<br>        System.out.println(<span class="hljs-string">&quot;[+] libsgmainso-6.6.231201.33656539.so init, result: &quot;</span> + result2);<br><br>        <span class="hljs-comment">// 10102 libsgsecuritybodyso-6.6.231201.33656539.so</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">cmdId3</span> <span class="hljs-operator">=</span> <span class="hljs-number">10102</span>;<br>        <span class="hljs-type">ArrayObject</span> <span class="hljs-variable">obj3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayObject</span>(<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;securitybody&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;6.6.231201.33656539&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;/data/app/com.taobao.idlefish-Mk5qkEh32zCm7x9fbp9IBw==/lib/arm64/libsgsecuritybodyso-6.6.231201.33656539.so&quot;</span>)<br>        );<br>        System.out.println(<span class="hljs-string">&quot;[+] ---------------------------------- 10102 libsgsecuritybodyso-6.6.231201.33656539.so --------------------------------&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result3</span> <span class="hljs-operator">=</span> JNICLibraryClzz.callStaticJniMethodObject(emulator,<br>                        <span class="hljs-string">&quot;doCommandNative(I[Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>,<br>                        cmdId3, obj3)<br>                .getValue().toString();<br>        System.out.println(<span class="hljs-string">&quot;[+] libsgsecuritybodyso-6.6.231201.33656539.so init, result: &quot;</span> + result3);<br><br>        <span class="hljs-comment">// 10102 libsgmiddletierso-6.6.231201.33656539.so</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">cmdId4</span> <span class="hljs-operator">=</span> <span class="hljs-number">10102</span>;<br>        <span class="hljs-type">ArrayObject</span> <span class="hljs-variable">obj4</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayObject</span>(<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;middletier&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;6.6.231201.33656539&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;/data/app/com.taobao.idlefish-Mk5qkEh32zCm7x9fbp9IBw==/lib/arm64/libsgmiddletierso-6.6.231201.33656539.so&quot;</span>)<br>        );<br>        System.out.println(<span class="hljs-string">&quot;[+] ---------------------------------- 10102 libsgmiddletierso-6.6.231201.33656539.so --------------------------------&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result4</span> <span class="hljs-operator">=</span> JNICLibraryClzz.callStaticJniMethodObject(emulator,<br>                        <span class="hljs-string">&quot;doCommandNative(I[Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>,<br>                        cmdId4, obj4)<br>                .getValue().toString();<br>        System.out.println(<span class="hljs-string">&quot;[+] libsgmiddletierso-6.6.231201.33656539.so init, result: &quot;</span> + result4);<br><br>        <span class="hljs-comment">// 70102 x-系列参数生成</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">cmdId5</span> <span class="hljs-operator">=</span> <span class="hljs-number">70102</span>;<br>        <span class="hljs-type">ArrayObject</span> <span class="hljs-variable">obj5</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayObject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;21407387&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;aVvA4IboYJQDAPf8FcEC0UhS&amp;&amp;&amp;21407387&amp;a0fe5c4111c15cc20e9c7d1e435d1e4a&amp;1767857182&amp;mtop.taobao.idlemtopsearch.search&amp;1.0&amp;&amp;231200@fleamarket_android_7.24.50&amp;&amp;0&amp;0&amp;openappkey=DEFAULT_AUTH&amp;27&amp;&amp;&amp;&amp;&amp;&amp;&amp;&quot;</span>),<br>                DvmBoolean.valueOf(vm, <span class="hljs-literal">false</span>),<br>                DvmInteger.valueOf(vm, <span class="hljs-number">0</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;mtop.taobao.idlemtopsearch.search&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;pageId=&amp;pageName=&quot;</span>),<br>                <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;r_43&quot;</span>),<br>                DvmInteger.valueOf(vm, <span class="hljs-number">0</span>),<br>                DvmInteger.valueOf(vm, <span class="hljs-number">0</span>)<br>        );<br>        System.out.println(<span class="hljs-string">&quot;[+] ---------------------------------- 70102 x-系列参数生成 --------------------------------&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result5</span> <span class="hljs-operator">=</span> JNICLibraryClzz.callStaticJniMethodObject(emulator,<br>                        <span class="hljs-string">&quot;doCommandNative(I[Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>,<br>                        cmdId5, obj5)<br>                .getValue()<br>                .toString();<br>        System.out.println(<span class="hljs-string">&quot;call doCommandNative function: &quot;</span> + result5);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">JNICLibrary</span> <span class="hljs-variable">jnicLibrary</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JNICLibrary</span>();<br>        jnicLibrary.calldoCommandNative();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">JNIEnv-&gt;GetStaticMethodID(com<span class="hljs-regexp">/alibaba/</span>wireless<span class="hljs-regexp">/security/m</span>ainplugin<span class="hljs-regexp">/SecurityGuardMainPlugin.getMainPluginClassLoader()Ljava/</span>lang/ClassLoader;) =&gt; <span class="hljs-number">0</span>xcc338928 was called <span class="hljs-keyword">from</span> RX@<span class="hljs-number">0</span>x1207181c[libmain.so]<span class="hljs-number">0</span>x7181c<br>[<span class="hljs-number">16</span>:<span class="hljs-number">51</span>:<span class="hljs-number">22</span> <span class="hljs-number">404</span>]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:<span class="hljs-number">410</span>) - handleInterrupt intno=<span class="hljs-number">2</span>, NR=-<span class="hljs-number">869037784</span>, svcNumber=<span class="hljs-number">0</span>x16e, PC=unidbg@<span class="hljs-number">0</span>xfffe0774, LR=RX@<span class="hljs-number">0</span>x1207183c[libmain.so]<span class="hljs-number">0</span>x7183c, syscall=<span class="hljs-keyword">null</span><br>java.lang.UnsupportedOperationException: com<span class="hljs-regexp">/alibaba/</span>wireless<span class="hljs-regexp">/security/m</span>ainplugin<span class="hljs-regexp">/SecurityGuardMainPlugin-&gt;getMainPluginClassLoader()Ljava/</span>lang/ClassLoader;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethod(AbstractJni.java:<span class="hljs-number">433</span>)<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/alibaba/wireless/security/mainplugin/SecurityGuardMainPlugin-&gt;getMainPluginClassLoader()Ljava/lang/ClassLoader;&quot;</span>: &#123;<br>    <span class="hljs-comment">// return vm.resolveClass(&quot;java/lang/ClassLoader&quot;).newObject(null);</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassLoader</span>(vm, signature);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">JNIEnv-&gt;GetMethodID(com/taobao/idlefish/TaoBaoApplication.getPackageCodePath()Ljava/lang/String;) =&gt; 0xfc688c30 was called <span class="hljs-keyword">from</span> RX@0x12028ab0[libmain.so]0x28ab0<br>[16:52:01 382]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=-130448, <span class="hljs-attribute">svcNumber</span>=0x11e, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0274, <span class="hljs-attribute">LR</span>=RX@0x12028ad0[libmain.so]0x28ad0, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.UnsupportedOperationException: com/taobao/idlefish/TaoBaoApplication-&gt;getPackageCodePath()Ljava/lang/String;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethod(AbstractJni.java:933)<br></code></pre></td></tr></table></figure>

<p>通过ActivityThread获取当前Application实例，然后调用相应方法获取返回值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/taobao/idlefish/TaoBaoApplication-&gt;getPackageCodePath()Ljava/lang/String;&quot;</span>:&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;/data/app/com.taobao.idlefish-Mk5qkEh32zCm7x9fbp9IBw==/base.apk&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">JNIEnv-&gt;GetMethodID(com/taobao/idlefish/TaoBaoApplication.getFilesDir()Ljava/io/File;) =&gt; 0x91796021 was called <span class="hljs-keyword">from</span> RX@0x12028b20[libmain.so]0x28b20<br>[16:54:14 511]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=-130448, <span class="hljs-attribute">svcNumber</span>=0x11e, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0274, <span class="hljs-attribute">LR</span>=RX@0x12028b40[libmain.so]0x28b40, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.UnsupportedOperationException: com/taobao/idlefish/TaoBaoApplication-&gt;getFilesDir()Ljava/io/File;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethod(AbstractJni.java:933)<br></code></pre></td></tr></table></figure>

<p>可能需要文件路径重定向？毕竟<code>new File</code>是电脑端执行的，映射的是本地路径。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/taobao/idlefish/TaoBaoApplication-&gt;getFilesDir()Ljava/io/File;&quot;</span>: &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/data/user/0/com.taobao.idlefish/files&quot;</span>;<br>    <span class="hljs-keyword">return</span> vm.resolveClass(<span class="hljs-string">&quot;java/io/File&quot;</span>).newObject(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path));<br>&#125;<br></code></pre></td></tr></table></figure>

<p>接下来就是这个文件的方法</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">JNIEnv-&gt;GetMethodID(java/io/File.getAbsolutePath()Ljava/lang/String;) =&gt; 0xb4553f34 was called <span class="hljs-keyword">from</span> RX@0x12028b88[libmain.so]0x28b88<br>[16:58:01 701]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=-130448, <span class="hljs-attribute">svcNumber</span>=0x11e, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0274, <span class="hljs-attribute">LR</span>=RX@0x12028ba8[libmain.so]0x28ba8, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.UnsupportedOperationException: java/io/File-&gt;getAbsolutePath()Ljava/lang/String;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethod(AbstractJni.java:933)<br></code></pre></td></tr></table></figure>

<p>不能直接获取File对象并执行相应方法，刚才说过，路径是本地的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java/io/File-&gt;getAbsolutePath()Ljava/lang/String;&quot;</span>: &#123;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> (File)dvmObject.getValue();<br>    <span class="hljs-comment">// 会带上盘符！！！</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">absolutePath</span> <span class="hljs-operator">=</span> file.getAbsolutePath();<br>    System.out.println(<span class="hljs-string">&quot;java/io/File-&gt;getAbsolutePath() called: &quot;</span> + absolutePath);<br>    <span class="hljs-comment">//                return new StringObject(vm, absolutePath);</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;/data/user/0/com.taobao.idlefish/files&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">JNIEnv-&gt;<span class="hljs-built_in">GetMethodID</span>(com/taobao/idlefish/TaoBaoApplication<span class="hljs-selector-class">.getApplicationInfo</span>()Landroid/<span class="hljs-attribute">content</span>/pm/ApplicationInfo;) =&gt; <span class="hljs-number">0</span>x73a4c4f9 was called from RX@<span class="hljs-number">0</span>x12028bf0<span class="hljs-selector-attr">[libmain.so]</span><span class="hljs-number">0</span>x28bf0<br><span class="hljs-selector-attr">[17:00:15 872]</span>  WARN <span class="hljs-selector-attr">[com.github.unidbg.linux.ARM64SyscallHandler]</span> (ARM64SyscallHandler:<span class="hljs-number">410</span>) - handleInterrupt intno=<span class="hljs-number">2</span>, NR=-<span class="hljs-number">130448</span>, svcNumber=<span class="hljs-number">0</span>x11e, PC=unidbg@<span class="hljs-number">0</span>xfffe0274, LR=RX@<span class="hljs-number">0</span>x12028c3c<span class="hljs-selector-attr">[libmain.so]</span><span class="hljs-number">0</span>x28c3c, syscall=null<br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.UnsupportedOperationException</span>: com/taobao/idlefish/TaoBaoApplication-&gt;<span class="hljs-built_in">getApplicationInfo</span>()Landroid/<span class="hljs-attribute">content</span>/pm/ApplicationInfo;<br>	at com<span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.unidbg</span><span class="hljs-selector-class">.linux</span><span class="hljs-selector-class">.android</span><span class="hljs-selector-class">.dvm</span><span class="hljs-selector-class">.AbstractJni</span><span class="hljs-selector-class">.callObjectMethod</span>(AbstractJni<span class="hljs-selector-class">.java</span>:<span class="hljs-number">933</span>)<br>	at com<span class="hljs-selector-class">.taobao</span><span class="hljs-selector-class">.idlefish</span><span class="hljs-selector-class">.MyAbstractJni</span><span class="hljs-selector-class">.callObjectMethod</span>(MyAbstractJni<span class="hljs-selector-class">.java</span>:<span class="hljs-number">48</span>)<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/taobao/idlefish/TaoBaoApplication-&gt;getApplicationInfo()Landroid/content/pm/ApplicationInfo;&quot;</span>: &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationInfo</span>(vm);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">JNIEnv-&gt;GetFieldID(android/content/pm/ApplicationInfo.nativeLibraryDir Ljava/lang/String;) =&gt; 0x1fabc7e8 was called <span class="hljs-keyword">from</span> RX@0x1202931c[libmain.so]0x2931c<br>[17:01:34 211]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=-129472, <span class="hljs-attribute">svcNumber</span>=0x15b, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0644, <span class="hljs-attribute">LR</span>=RX@0x12029360[libmain.so]0x29360, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.UnsupportedOperationException: android/content/pm/ApplicationInfo-&gt;nativeLibraryDir:Ljava/lang/String;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.getObjectField(AbstractJni.java:171)<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;android/content/pm/ApplicationInfo-&gt;nativeLibraryDir:Ljava/lang/String;&quot;</span>: &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;/data/app/com.taobao.idlefish-Mk5qkEh32zCm7x9fbp9IBw==/lib/arm64&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">JNIEnv-&gt;NewStringUTF(<span class="hljs-string">&quot;sgCallBackUniqueKey&quot;</span>) was called <span class="hljs-keyword">from</span> RX@0x12109164[libmain.so]0x109164<br>[17:03:46 856]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=-125376, <span class="hljs-attribute">svcNumber</span>=0x17d, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0864, <span class="hljs-attribute">LR</span>=RX@0x1205bd94[libmain.so]0x5bd94, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.UnsupportedOperationException: com/uc2/crashsdk/JNIBridge-&gt;registerInfoCallback(Ljava/lang/String;IJI)I<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticIntMethod(AbstractJni.java:201<br></code></pre></td></tr></table></figure>

<p>遍历的classloader并没有找到该类，取值参考了<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-268927-1.htm">https://bbs.kanxue.com/thread-268927-1.htm</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/uc2/crashsdk/JNIBridge-&gt;registerInfoCallback(Ljava/lang/String;IJI)I&quot;</span>: &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">arg1</span> <span class="hljs-operator">=</span> varArg.getObjectArg(<span class="hljs-number">0</span>).getValue().toString();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">arg2</span> <span class="hljs-operator">=</span> varArg.getIntArg(<span class="hljs-number">1</span>);<br>    <span class="hljs-type">long</span> <span class="hljs-variable">arg3</span> <span class="hljs-operator">=</span> varArg.getLongArg(<span class="hljs-number">2</span>);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">arg4</span> <span class="hljs-operator">=</span> varArg.getIntArg(<span class="hljs-number">3</span>);<br>    System.out.println(<span class="hljs-string">&quot;registerInfoCallback called: arg1 = &quot;</span> + arg1 +<span class="hljs-string">&quot;, arg2 = &quot;</span> + arg2 + <span class="hljs-string">&quot;, arg3 = &quot;</span> + arg3 + <span class="hljs-string">&quot;, arg4 = &quot;</span> + arg4);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<span class="hljs-comment">// 1     0: 多一个maps的读取</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">JNIEnv-&gt;<span class="hljs-built_in">CallStaticIntMethod</span>(class com/uc2/crashsdk/JNIBridge, <span class="hljs-built_in">registerInfoCallback</span>(<span class="hljs-string">&quot;sgCallBackUniqueKey&quot;</span>, <span class="hljs-number">0</span>x101, <span class="hljs-number">0</span>x1205b0ccL, <span class="hljs-number">0</span>x1) =&gt; <span class="hljs-number">0</span>x1) was called from RX@<span class="hljs-number">0</span>x1205bd94<span class="hljs-selector-attr">[libmain.so]</span><span class="hljs-number">0</span>x5bd94<br><span class="hljs-selector-attr">[17:06:45 689]</span>  WARN <span class="hljs-selector-attr">[com.github.unidbg.linux.ARM64SyscallHandler]</span> (ARM64SyscallHandler:<span class="hljs-number">410</span>) - handleInterrupt intno=<span class="hljs-number">2</span>, NR=-<span class="hljs-number">129120</span>, svcNumber=<span class="hljs-number">0</span>x171, PC=unidbg@<span class="hljs-number">0</span>xfffe07a4, LR=RX@<span class="hljs-number">0</span>x1202a9a0<span class="hljs-selector-attr">[libmain.so]</span><span class="hljs-number">0</span>x2a9a0, syscall=null<br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.UnsupportedOperationException</span>: com/alibaba/wireless/security/framework/ApmMonitorAdapter-&gt;<span class="hljs-built_in">isEnableFullTrackRecord</span>()Z<br>	at com<span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.unidbg</span><span class="hljs-selector-class">.linux</span><span class="hljs-selector-class">.android</span><span class="hljs-selector-class">.dvm</span><span class="hljs-selector-class">.AbstractJni</span><span class="hljs-selector-class">.callStaticBooleanMethod</span>(AbstractJni<span class="hljs-selector-class">.java</span>:<span class="hljs-number">181</span>)<br></code></pre></td></tr></table></figure>

<p>静态方法，那就使用frida主动调用获取具体值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/alibaba/wireless/security/framework/ApmMonitorAdapter-&gt;isEnableFullTrackRecord()Z&quot;</span>: &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[17:09:44 393]</span>  INFO <span class="hljs-selector-attr">[com.github.unidbg.linux.ARM64SyscallHandler]</span> (ARM64SyscallHandler:<span class="hljs-number">712</span>) - stat64 pathname=/data/user/<span class="hljs-number">0</span>/com<span class="hljs-selector-class">.taobao</span>.idlefish/app_SGLib/.sf/<span class="hljs-selector-class">.nee</span><br><span class="hljs-selector-attr">[17:09:44 397]</span>  WARN <span class="hljs-selector-attr">[com.github.unidbg.linux.ARM64SyscallHandler]</span> (ARM64SyscallHandler:<span class="hljs-number">410</span>) - handleInterrupt intno=<span class="hljs-number">2</span>, NR=-<span class="hljs-number">130544</span>, svcNumber=<span class="hljs-number">0</span>x118, PC=unidbg@<span class="hljs-number">0</span>xfffe0214, LR=RX@<span class="hljs-number">0</span>x1210a3d0<span class="hljs-selector-attr">[libmain.so]</span><span class="hljs-number">0</span>x10a3d0, syscall=null<br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.UnsupportedOperationException</span>: java/lang/Integer-&gt;&lt;init&gt;(I)V<br>	at com<span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.unidbg</span><span class="hljs-selector-class">.linux</span><span class="hljs-selector-class">.android</span><span class="hljs-selector-class">.dvm</span><span class="hljs-selector-class">.AbstractJni</span><span class="hljs-selector-class">.newObject</span>(AbstractJni<span class="hljs-selector-class">.java</span>:<span class="hljs-number">763</span>)<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java/lang/Integer-&gt;&lt;init&gt;(I)V&quot;</span>:&#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">arg1</span> <span class="hljs-operator">=</span> varArg.getIntArg(<span class="hljs-number">0</span>);<br>    System.out.println(<span class="hljs-string">&quot;java/lang/Integer-&gt;&lt;init&gt;(I)V called: &quot;</span> + arg1);<br>    <span class="hljs-keyword">return</span>  vm.resolveClass(<span class="hljs-string">&quot;java/lang/Integer&quot;</span>).newObject(arg1);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>重新运行后，发现跑通了<code>10101 app_SGLib</code>以及<code>10102 libsgmainso-6.6.231201.33656539.so</code>。之后就存在一个致命报错</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">JNIEnv-&gt;<span class="hljs-built_in">GetStaticFieldID</span>(com/alibaba/wireless/security/framework/SGPluginExtras.slotJ) =&gt; <span class="hljs-number">0</span>x24d12279 was called from RX@<span class="hljs-number">0</span>x12029b0c<span class="hljs-selector-attr">[libmain.so]</span><span class="hljs-number">0</span>x29b0c<br><span class="hljs-selector-attr">[17:11:47 299]</span>  WARN <span class="hljs-selector-attr">[com.github.unidbg.linux.ARM64SyscallHandler]</span> (ARM64SyscallHandler:<span class="hljs-number">410</span>) - handleInterrupt intno=<span class="hljs-number">2</span>, NR=-<span class="hljs-number">128576</span>, svcNumber=<span class="hljs-number">0</span>x193, PC=unidbg@<span class="hljs-number">0</span>xfffe09c4, LR=RX@<span class="hljs-number">0</span>x12029b30<span class="hljs-selector-attr">[libmain.so]</span><span class="hljs-number">0</span>x29b30, syscall=null<br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.UnsupportedOperationException</span>: com/alibaba/wireless/security/framework/SGPluginExtras-&gt;slot:J<br>	at com<span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.unidbg</span><span class="hljs-selector-class">.linux</span><span class="hljs-selector-class">.android</span><span class="hljs-selector-class">.dvm</span><span class="hljs-selector-class">.AbstractJni</span><span class="hljs-selector-class">.getStaticLongField</span>(AbstractJni<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1084</span>)<br></code></pre></td></tr></table></figure>

<p><code>slot</code>值没有设置初始值就直接获取，尝试如下修复</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">slot</span> <span class="hljs-operator">=</span> <span class="hljs-number">0L</span>;<br><br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/alibaba/wireless/security/framework/SGPluginExtras-&gt;slot:J&quot;</span>: &#123;<br>    <span class="hljs-keyword">return</span> slot;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>然后就出现了<code>libsgsecuritybodyso</code> dlopen失败的报错（一度怀疑slot跟libsgsecuritybodyso的加载有关，卡了好久）</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[17:16:42 416]</span>  INFO <span class="hljs-selector-attr">[com.github.unidbg.linux.android.ArmLD64]</span> (ArmLD64:<span class="hljs-number">308</span>) - dlopen failed: /data/app/com<span class="hljs-selector-class">.taobao</span>.idlefish-Mk5qkEh32zCm7x9fbp9IBw==/lib/arm64/libsgsecuritybodyso-<span class="hljs-number">6.6</span>.<span class="hljs-number">231201.33656539</span><span class="hljs-selector-class">.so</span><br><span class="hljs-selector-attr">[17:16:42 417]</span>  WARN <span class="hljs-selector-attr">[com.github.unidbg.linux.ARM64SyscallHandler]</span> (ARM64SyscallHandler:<span class="hljs-number">410</span>) - handleInterrupt intno=<span class="hljs-number">2</span>, NR=<span class="hljs-number">302161312</span>, svcNumber=<span class="hljs-number">0</span>x1f1, PC=unidbg@<span class="hljs-number">0</span>xfffe174c<span class="hljs-selector-attr">[libandroid.so]</span><span class="hljs-number">0</span>x74c, LR=RX@<span class="hljs-number">0</span>x12029dac<span class="hljs-selector-attr">[libmain.so]</span><span class="hljs-number">0</span>x29dac, syscall=null<br>com<span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.unidbg</span><span class="hljs-selector-class">.InvalidMemoryAccessException</span><br>	at com<span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.unidbg</span><span class="hljs-selector-class">.pointer</span><span class="hljs-selector-class">.UnidbgPointer</span><span class="hljs-selector-class">.write</span>(UnidbgPointer<span class="hljs-selector-class">.java</span>:<span class="hljs-number">168</span>)<br></code></pre></td></tr></table></figure>

<p>经查询，该文件确实存在于<code>rootfs</code>目录下，且文件路径没有问题。发给gpt，告诉我可以手动加载该库。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">DalvikModule</span> <span class="hljs-variable">dm</span> <span class="hljs-operator">=</span> vm.loadLibrary(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;unidbg-android/src/test/resources/xianyu/rootfs/data/app/com.taobao.idlefish-Mk5qkEh32zCm7x9fbp9IBw==/lib/arm64/libsgsecuritybodyso-6.6.231201.33656539.so&quot;</span>), <span class="hljs-literal">true</span>);<br>dm.callJNI_OnLoad(emulator);<br></code></pre></td></tr></table></figure>

<p>没想到居然成功了！接下来报错</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">JNIEnv-&gt;GetStaticMethodID(com<span class="hljs-regexp">/alibaba/</span>wireless<span class="hljs-regexp">/security/</span>securitybody<span class="hljs-regexp">/SecurityGuardSecurityBodyPlugin.getPluginClassLoader()Ljava/</span>lang/ClassLoader;) =&gt; <span class="hljs-number">0</span>xbc565e30 was called <span class="hljs-keyword">from</span> RX@<span class="hljs-number">0</span>x1311d7d8[libsecuritybody.so]<span class="hljs-number">0</span>x1d7d8<br>[<span class="hljs-number">17</span>:<span class="hljs-number">42</span>:<span class="hljs-number">39</span> <span class="hljs-number">706</span>]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:<span class="hljs-number">410</span>) - handleInterrupt intno=<span class="hljs-number">2</span>, NR=-<span class="hljs-number">1135190480</span>, svcNumber=<span class="hljs-number">0</span>x16e, PC=unidbg@<span class="hljs-number">0</span>xfffe0774, LR=RX@<span class="hljs-number">0</span>x1311d7f8[libsecuritybody.so]<span class="hljs-number">0</span>x1d7f8, syscall=<span class="hljs-keyword">null</span><br>java.lang.UnsupportedOperationException: com<span class="hljs-regexp">/alibaba/</span>wireless<span class="hljs-regexp">/security/</span>securitybody<span class="hljs-regexp">/SecurityGuardSecurityBodyPlugin-&gt;getPluginClassLoader()Ljava/</span>lang/ClassLoader;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethod(AbstractJni.java:<span class="hljs-number">433</span>)<br></code></pre></td></tr></table></figure>

<p>这次参考刚才的给出的文章链接</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/alibaba/wireless/security/securitybody/SecurityGuardSecurityBodyPlugin-&gt;getPluginClassLoader()Ljava/lang/ClassLoader;&quot;</span>: &#123;<br>    <span class="hljs-keyword">return</span> vm.resolveClass(<span class="hljs-string">&quot;dalvik/system/PathClassLoader&quot;</span>).newObject(<span class="hljs-built_in">this</span>.getClass().getClassLoader());<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">JNIEnv-&gt;GetStaticMethodID(com<span class="hljs-regexp">/taobao/</span>dp<span class="hljs-regexp">/util/</span>CallbackHelper.getInstance()Lcom<span class="hljs-regexp">/taobao/</span>dp<span class="hljs-regexp">/util/</span>CallbackHelper;) =&gt; <span class="hljs-number">0</span>x70e6476c was called <span class="hljs-keyword">from</span> RX@<span class="hljs-number">0</span>x1311dc14[libsecuritybody.so]<span class="hljs-number">0</span>x1dc14<br>[<span class="hljs-number">17</span>:<span class="hljs-number">48</span>:<span class="hljs-number">30</span> <span class="hljs-number">721</span>]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:<span class="hljs-number">410</span>) - handleInterrupt intno=<span class="hljs-number">2</span>, NR=<span class="hljs-number">1894139756</span>, svcNumber=<span class="hljs-number">0</span>x16e, PC=unidbg@<span class="hljs-number">0</span>xfffe0774, LR=RX@<span class="hljs-number">0</span>x1311dc34[libsecuritybody.so]<span class="hljs-number">0</span>x1dc34, syscall=<span class="hljs-keyword">null</span><br>java.lang.UnsupportedOperationException: com<span class="hljs-regexp">/taobao/</span>dp<span class="hljs-regexp">/util/</span>CallbackHelper-&gt;getInstance()Lcom<span class="hljs-regexp">/taobao/</span>dp<span class="hljs-regexp">/util/</span>CallbackHelper;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethod(AbstractJni.java:<span class="hljs-number">433</span>)<br></code></pre></td></tr></table></figure>

<p>返回对应类的空对象进行占位</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/taobao/dp/util/CallbackHelper-&gt;getInstance()Lcom/taobao/dp/util/CallbackHelper;&quot;</span>: &#123;<br>    <span class="hljs-keyword">return</span>  vm.resolveClass(<span class="hljs-string">&quot;com/taobao/dp/util/CallbackHelper&quot;</span>).newObject(<span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">JNIEnv-&gt;GetStaticMethodID(com<span class="hljs-regexp">/alibaba/</span>wireless<span class="hljs-regexp">/security/</span>securitybody<span class="hljs-regexp">/InvocationHandlerAdapter.getClassLoader()Ljava/</span>lang/ClassLoader;) =&gt; <span class="hljs-number">0</span>x34a7c06 was called <span class="hljs-keyword">from</span> RX@<span class="hljs-number">0</span>x13107f68[libsecuritybody.so]<span class="hljs-number">0</span>x7f68<br>[<span class="hljs-number">17</span>:<span class="hljs-number">50</span>:<span class="hljs-number">35</span> <span class="hljs-number">328</span>]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:<span class="hljs-number">410</span>) - handleInterrupt intno=<span class="hljs-number">2</span>, NR=-<span class="hljs-number">129168</span>, svcNumber=<span class="hljs-number">0</span>x16e, PC=unidbg@<span class="hljs-number">0</span>xfffe0774, LR=RX@<span class="hljs-number">0</span>x13107f94[libsecuritybody.so]<span class="hljs-number">0</span>x7f94, syscall=<span class="hljs-keyword">null</span><br>java.lang.UnsupportedOperationException: com<span class="hljs-regexp">/alibaba/</span>wireless<span class="hljs-regexp">/security/</span>securitybody<span class="hljs-regexp">/InvocationHandlerAdapter-&gt;getClassLoader()Ljava/</span>lang/ClassLoader;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethod(AbstractJni.java:<span class="hljs-number">433</span>)<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/alibaba/wireless/security/securitybody/InvocationHandlerAdapter-&gt;getClassLoader()Ljava/lang/ClassLoader;&quot;</span>: &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassLoader</span>(vm, signature);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>接下来终于到了slot的<code>SetStaticLongField</code>报错</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">JNIEnv-&gt;<span class="hljs-built_in">SetStaticLongField</span>(class com/alibaba/wireless/security/framework/SGPluginExtras, slot, <span class="hljs-number">0</span>x1310528b) was called from RX@<span class="hljs-number">0</span>x13138e5c<span class="hljs-selector-attr">[libsecuritybody.so]</span><span class="hljs-number">0</span>x38e5c<br><span class="hljs-selector-attr">[17:52:29 510]</span>  WARN <span class="hljs-selector-attr">[com.github.unidbg.linux.ARM64SyscallHandler]</span> (ARM64SyscallHandler:<span class="hljs-number">410</span>) - handleInterrupt intno=<span class="hljs-number">2</span>, NR=<span class="hljs-number">617685625</span>, svcNumber=<span class="hljs-number">0</span>x19c, PC=unidbg@<span class="hljs-number">0</span>xfffe0a54, LR=RX@<span class="hljs-number">0</span>x13138e5c<span class="hljs-selector-attr">[libsecuritybody.so]</span><span class="hljs-number">0</span>x38e5c, syscall=null<br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.UnsupportedOperationException</span>: com/alibaba/wireless/security/framework/SGPluginExtras-&gt;slot:J<br>	at com<span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.unidbg</span><span class="hljs-selector-class">.linux</span><span class="hljs-selector-class">.android</span><span class="hljs-selector-class">.dvm</span><span class="hljs-selector-class">.AbstractJni</span><span class="hljs-selector-class">.setStaticLongField</span>(AbstractJni<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1044</span>)<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/alibaba/wireless/security/framework/SGPluginExtras-&gt;slot:J&quot;</span>: &#123;<br>    slot = value;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">JNIEnv-&gt;NewStringUTF(<span class="hljs-string">&quot;com/alibaba/wireless/security/securitybody/ApmSecurityBodyPluginAdapter&quot;</span>) was called <span class="hljs-keyword">from</span> RX@0x1311d444[libsecuritybody.so]0x1d444<br>[17:54:43 740]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=-130448, <span class="hljs-attribute">svcNumber</span>=0x11e, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0274, <span class="hljs-attribute">LR</span>=RX@0x1311d464[libsecuritybody.so]0x1d464, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.UnsupportedOperationException: dalvik/system/PathClassLoader-&gt;findClass(Ljava/lang/String;)Ljava/lang/Class;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethod(AbstractJni.java:933)<br></code></pre></td></tr></table></figure>

<p>获取类名参数，通过<code>vm.resolveClass</code>让模拟器自己去找</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;dalvik/system/PathClassLoader-&gt;findClass(Ljava/lang/String;)Ljava/lang/Class;&quot;</span>: &#123;<br>    <span class="hljs-comment">// 获取类名</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> varArg.getObjectArg(<span class="hljs-number">0</span>).getValue().toString();<br>    <span class="hljs-keyword">return</span> vm.resolveClass(clazz);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错，看样子来到了设备信息采集环节了</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[18:01:18 986]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=-129168, <span class="hljs-attribute">svcNumber</span>=0x16e, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0774, <span class="hljs-attribute">LR</span>=RX@0x12046d68[libmain.so]0x46d68, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.UnsupportedOperationException: com/taobao/wireless/security/adapter/datacollection/DeviceInfoCapturer-&gt;doCommandForString(I)Ljava/lang/String;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethod(AbstractJni.java:433)<br></code></pre></td></tr></table></figure>

<p>通过枚举类加载器，确认该类在<code>/data/app/com.taobao.idlefish-Mk5qkEh32zCm7x9fbp9IBw==/lib/arm64/libsgmain.so</code>文件中</p>
<p><img src="https://raw.githubusercontent.com/gal2xy/blog_img/main/img/202602101633358.png" srcset="/img/loading.gif" lazyload></p>
<p>静态方法的话，在加载<code>libsgmain.so</code>后hook 该函数并主动调用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-number">122</span>:&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm,<span class="hljs-string">&quot;com.taobao.idlefish&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">File closed <span class="hljs-string">&#x27;/data/user/0/com.taobao.idlefish/files/0a231bd8575dcf72.txt&#x27;</span> from RX@<span class="hljs-number">0</span>x1231ece4<span class="hljs-selector-attr">[libc.so]</span><span class="hljs-number">0</span>x1ece4<br><span class="hljs-selector-attr">[19:57:59 936]</span>  WARN <span class="hljs-selector-attr">[com.github.unidbg.linux.ARM64SyscallHandler]</span> (ARM64SyscallHandler:<span class="hljs-number">410</span>) - handleInterrupt intno=<span class="hljs-number">2</span>, NR=<span class="hljs-number">303624712</span>, svcNumber=<span class="hljs-number">0</span>x17d, PC=unidbg@<span class="hljs-number">0</span>xfffe0864, LR=RX@<span class="hljs-number">0</span>x120546fc<span class="hljs-selector-attr">[libmain.so]</span><span class="hljs-number">0</span>x546fc, syscall=null<br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.UnsupportedOperationException</span>: com/alibaba/wireless/security/framework/utils/UserTrackMethodJniBridge-&gt;<span class="hljs-built_in">utAvaiable</span>()I<br>	at com<span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.unidbg</span><span class="hljs-selector-class">.linux</span><span class="hljs-selector-class">.android</span><span class="hljs-selector-class">.dvm</span><span class="hljs-selector-class">.AbstractJni</span><span class="hljs-selector-class">.callStaticIntMethod</span>(AbstractJni<span class="hljs-selector-class">.java</span>:<span class="hljs-number">201</span>)<br></code></pre></td></tr></table></figure>

<p>同刚才所述方法以获取返回值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/alibaba/wireless/security/framework/utils/UserTrackMethodJniBridge-&gt;utAvaiable()I&quot;</span>: &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>重新运行后，终于跑通了<code>10102 libsgsecuritybodyso-6.6.231201.33656539.so</code>和 <code>10102 libsgmiddletierso-6.6.231201.33656539.so</code>。接下来就是与70102 x-系列参数生成相关的报错了。</p>
<p>非常可惜！！！补了这么久的环境，结果到头来还是抛出 <code>SecException 701029904</code>报错！这说明初始化工作还是未完成！</p>
<hr>
<hr>
<hr>
<p>根据日志实现了其他早于70102的调用号，然而还是没有用。以下是相关调用号的实现，比较杂乱。</p>
<p>继续根据日志查找早于70102的调用号，在他之上是</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">&gt;&gt;&gt; doCommandNative is called: cmdId=<span class="hljs-number">70201</span>, objArr=<span class="hljs-selector-attr">[mwua, sgcipher]</span><br><span class="hljs-selector-attr">[+]</span> Object Array length: <span class="hljs-number">2</span><br>  <span class="hljs-selector-attr">[0]</span> (java<span class="hljs-selector-class">.lang</span>.String) mwua<br>  <span class="hljs-selector-attr">[1]</span> (java<span class="hljs-selector-class">.lang</span>.String) sgcipher<br>&lt;&lt;&lt; doCommandNative result=<span class="hljs-number">513661310394</span><br></code></pre></td></tr></table></figure>

<p>unidbg里调用发现此处出现同70102的SecException  702019904。同样也走到了SecException处。根据之前的分析，很可能是marjor_cmd（7）模块还未挂载</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs llvm">[+] ---------------------------------- cmdId<span class="hljs-operator">=</span><span class="hljs-number">70201</span><span class="hljs-punctuation">,</span> objArr<span class="hljs-operator">=</span>[mwua<span class="hljs-punctuation">,</span> sgcipher] --------------------------------<br>Find native function Java_com_taobao_wireless_security_adapter_JNICLibrary_doCommandNative <span class="hljs-operator">=</span>&gt; RX<span class="hljs-title">@0</span><span class="hljs-keyword">x</span><span class="hljs-number">120280</span><span class="hljs-keyword">c</span><span class="hljs-number">4</span>[libmain.so]<span class="hljs-number">0x280c4</span><br>JNIEnv-&gt;NewStringUTF(<span class="hljs-string">&quot;&quot;</span>) was called from RX<span class="hljs-title">@0</span><span class="hljs-keyword">x</span><span class="hljs-number">12109</span><span class="hljs-keyword">c</span><span class="hljs-number">4</span><span class="hljs-keyword">c</span>[libmain.so]<span class="hljs-number">0x109c4c</span><br>SecException&#123;message: <span class="hljs-punctuation">,</span> errorCode: <span class="hljs-number">702019904</span>&#125;<br></code></pre></td></tr></table></figure>

<p>继续往前追溯，找不是7的</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&gt;&gt;&gt; doCommandNative <span class="hljs-keyword">is</span> <span class="hljs-keyword">called</span>: cmdId=<span class="hljs-number">10602</span>, objArr=[<span class="hljs-number">0</span>, <span class="hljs-keyword">null</span>]<br>[+] <span class="hljs-keyword">Object</span> <span class="hljs-keyword">Array</span> length: <span class="hljs-number">2</span><br>  [<span class="hljs-number">0</span>] (java.lang.Integer) <span class="hljs-number">0</span><br>  [<span class="hljs-number">1</span>] <span class="hljs-keyword">null</span><br>&lt;&lt;&lt; doCommandNative result=<span class="hljs-number">21407387</span><br></code></pre></td></tr></table></figure>

<p>实现了但是没什么用</p>
<p>然后发现唯一调用号13806</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&gt;&gt;&gt; doCommandNative <span class="hljs-keyword">is</span> <span class="hljs-keyword">called</span>: cmdId=<span class="hljs-number">13806</span>, objArr=[<span class="hljs-number">0</span>]<br>[+] <span class="hljs-keyword">Object</span> <span class="hljs-keyword">Array</span> length: <span class="hljs-number">1</span><br>  [<span class="hljs-number">0</span>] (java.lang.Integer) <span class="hljs-number">0</span><br>&lt;&lt;&lt; doCommandNative result=<span class="hljs-keyword">null</span><br></code></pre></td></tr></table></figure>

<p>也没用</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs llvm">[+] ---------------------------------- cmdId<span class="hljs-operator">=</span><span class="hljs-number">70101</span><span class="hljs-punctuation">,</span> objArr<span class="hljs-operator">=</span>[<span class="hljs-keyword">null</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0</span>] --------------------------------<br>Find native function Java_com_taobao_wireless_security_adapter_JNICLibrary_doCommandNative <span class="hljs-operator">=</span>&gt; RX<span class="hljs-title">@0</span><span class="hljs-keyword">x</span><span class="hljs-number">120280</span><span class="hljs-keyword">c</span><span class="hljs-number">4</span>[libmain.so]<span class="hljs-number">0x280c4</span><br>JNIEnv-&gt;NewStringUTF(<span class="hljs-string">&quot;&quot;</span>) was called from RX<span class="hljs-title">@0</span><span class="hljs-keyword">x</span><span class="hljs-number">12109</span><span class="hljs-keyword">c</span><span class="hljs-number">4</span><span class="hljs-keyword">c</span>[libmain.so]<span class="hljs-number">0x109c4c</span><br>SecException&#123;message: <span class="hljs-punctuation">,</span> errorCode: <span class="hljs-number">701019904</span>&#125;<br></code></pre></td></tr></table></figure>

<p>再次证明主模块7未加载</p>
<p>然后是22302调用号</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&gt;&gt;&gt; doCommandNative <span class="hljs-keyword">is</span> <span class="hljs-keyword">called</span>: cmdId=<span class="hljs-number">22302</span>, objArr=[<span class="hljs-number">0</span>, <span class="hljs-keyword">false</span>]<br>[+] <span class="hljs-keyword">Object</span> <span class="hljs-keyword">Array</span> length: <span class="hljs-number">2</span><br>  [<span class="hljs-number">0</span>] (java.lang.Integer) <span class="hljs-number">0</span><br>  [<span class="hljs-number">1</span>] (java.lang.Boolean) <span class="hljs-keyword">false</span><br>&lt;&lt;&lt; doCommandNative result=<span class="hljs-number">8</span>D8BTHxLPMsF2QKbsklmu1VBFpGxb3W4<br></code></pre></td></tr></table></figure>

<p>添加后，提示补环境</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">DeviceInfoCapturer-&gt;doCommandForString called: arg1 = 135<br>[21:59:52 098]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=-129168, <span class="hljs-attribute">svcNumber</span>=0x16e, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0774, <span class="hljs-attribute">LR</span>=RX@0x12046d68[libmain.so]0x46d68, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.IndexOutOfBoundsException: Index 1 out of bounds <span class="hljs-keyword">for</span> length 1<br>	at java.base/jdk.internal.util.Preconditions.outOfBounds(Preconditions.java:64)<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;com/taobao/wireless/security/adapter/datacollection/DeviceInfoCapturer-&gt;doCommandForString(I)Ljava/lang/String;&quot;</span>: &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">arg1</span> <span class="hljs-operator">=</span> varArg.getIntArg(<span class="hljs-number">0</span>);<br>    System.out.println(<span class="hljs-string">&quot;DeviceInfoCapturer-&gt;doCommandForString called: arg1 = &quot;</span> + arg1);<br>    <span class="hljs-keyword">switch</span> (arg1)&#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">122</span>:&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;com.taobao.idlefish&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">135</span>:&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringObject</span>(vm, <span class="hljs-string">&quot;aWTitjAtFNcDALD1RXzM/mEk&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>然后发现<code>aWTitjAtFNcDALD1RXzM/mEk</code>的值是调用号70102的参数的一部分</p>
<p>继续补环境报错</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">SPUtility2-&gt;readFromSPUnified called: <span class="hljs-attribute">arg1</span>=LOCAL_DEVICE_INFO, <span class="hljs-attribute">arg2</span>=982c1b269b8e023e5aede2421cbf9c48, <span class="hljs-attribute">arg3</span>=<span class="hljs-literal">null</span><br>[22:06:59 394]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=-129168, <span class="hljs-attribute">svcNumber</span>=0x16e, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0774, <span class="hljs-attribute">LR</span>=RX@0x120f1cbc[libmain.so]0xf1cbc, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.UnsupportedOperationException: com/taobao/wireless/security/adapter/common/SPUtility2-&gt;readFromSPUnified(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethod(AbstractJni.java:433)<br></code></pre></td></tr></table></figure>

<p>通过frida hook获取该值</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&gt;&gt;&gt; readFromSPUnified is called: <span class="hljs-attribute">str1</span>=LOCAL_DEVICE_INFO, <span class="hljs-attribute">str2</span>=982c1b269b8e023e5aede2421cbf9c48, <span class="hljs-attribute">str3</span>=<span class="hljs-literal">null</span><br>&lt;&lt;&lt; readFromSPUnified <span class="hljs-attribute">result</span>=aWTitjAtFNcDALD1RXzM/mEk<br></code></pre></td></tr></table></figure>

<p>最终发现模拟执行的返回值和真机的不一样！！！</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-literal">[+]</span> <span class="hljs-keyword">do</span><span class="hljs-constructor">CommandNative(<span class="hljs-params">cmdId</span>=22302, <span class="hljs-params">objArr</span>=[0, <span class="hljs-params">false</span>])</span>, result: aWTitjAtFNcDALD1RXzM/mEk<br></code></pre></td></tr></table></figure>

<p>这说明环境没补对。</p>
<p>然后是10401调用号</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">&gt;&gt;&gt; doCommandNative is called: cmdId=<span class="hljs-number">10401</span>, objArr=<span class="hljs-selector-attr">[&#123;INPUT=2&amp;reg02fsZKlvv85CN39rSMkUn0BHcUkUV&amp;21407387&amp;1&#125;, 21407387, 3, , true]</span><br><span class="hljs-selector-attr">[+]</span> Object Array length: <span class="hljs-number">5</span><br>  <span class="hljs-selector-attr">[0]</span> (java<span class="hljs-selector-class">.util</span>.HashMap) &#123;INPUT=<span class="hljs-number">2</span>&amp;reg02fsZKlvv85CN39rSMkUn0BHcUkUV&amp;<span class="hljs-number">21407387</span>&amp;<span class="hljs-number">1</span>&#125;<br>  <span class="hljs-selector-attr">[1]</span> (java<span class="hljs-selector-class">.lang</span>.String) <span class="hljs-number">21407387</span><br>  <span class="hljs-selector-attr">[2]</span> (java<span class="hljs-selector-class">.lang</span>.Integer) <span class="hljs-number">3</span><br>  <span class="hljs-selector-attr">[3]</span> (java<span class="hljs-selector-class">.lang</span>.String) <br>  <span class="hljs-selector-attr">[4]</span> (java<span class="hljs-selector-class">.lang</span>.Boolean) true<br>&lt;&lt;&lt; doCommandNative result=d61e098f56394a1221d99ece493fc3bdb0367559<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">JNIEnv-&gt;GetObjectArrayElement([java.util.HashMap@1b1426f4, <span class="hljs-string">&quot;21407387&quot;</span>, java.lang.Integer@32b260fa, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-literal">true</span>], 0) =&gt; java.util.HashMap@1b1426f4 was called <span class="hljs-keyword">from</span> RX@0x1210cf10[libmain.so]0x10cf10<br>[11:36:01 011]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=-130448, <span class="hljs-attribute">svcNumber</span>=0x11e, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0274, <span class="hljs-attribute">LR</span>=RX@0x1210cf90[libmain.so]0x10cf90, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.UnsupportedOperationException: java/util/HashMap-&gt;keySet()Ljava/util/Set;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethod(AbstractJni.java:933)<br>	at com.taobao.idlefish.MyAbstractJni.callObjectMethod(MyAbstractJni.java:116)<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java/util/HashMap-&gt;keySet()Ljava/util/Set;&quot;</span>: &#123;<br>    <span class="hljs-type">HashMap</span> <span class="hljs-variable">hashMap</span> <span class="hljs-operator">=</span> (HashMap) dvmObject.getValue();<br>    System.out.println(<span class="hljs-string">&quot;java/util/HashMap-&gt;keySet() called: &quot;</span> + hashMap);<br>    <span class="hljs-type">Set</span> <span class="hljs-variable">set</span> <span class="hljs-operator">=</span> hashMap.keySet();<br>    <span class="hljs-keyword">return</span> vm.resolveClass(<span class="hljs-string">&quot;java/util/Set&quot;</span>).newObject(set);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[11:47:59 356]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=48208774, <span class="hljs-attribute">svcNumber</span>=0x11e, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0274, <span class="hljs-attribute">LR</span>=RX@0x1210cfb0[libmain.so]0x10cfb0, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.UnsupportedOperationException: java/util/Set-&gt;toArray()[Ljava/lang/Object;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethod(AbstractJni.java:933)<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java/util/Set-&gt;toArray()[Ljava/lang/Object;&quot;</span>: &#123;<br>    <span class="hljs-type">Set</span> <span class="hljs-variable">set</span> <span class="hljs-operator">=</span> (Set)dvmObject.getValue();<br>    Object[] objects = set.toArray();<br>    <span class="hljs-comment">// 准备存储 DvmObject 的数组</span><br>    DvmObject&lt;?&gt;[] dvmObjects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DvmObject</span>[objects.length];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; objects.length; i++) &#123;<br>        <span class="hljs-comment">// 这里需要根据实际类型转换，如果是 String 则用 StringObject，如果是 Map 用 MapObject 等</span><br>        <span class="hljs-comment">// 或者简单地通过 ProxyDvmObject 转换</span><br>        dvmObjects[i] = ProxyDvmObject.createObject(vm, objects[i]);<br>    &#125;<br><br>    <span class="hljs-comment">// 返回一个 ArrayObject，它在 JNI 层对应 [Ljava/lang/Object;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayObject</span>(dvmObjects);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[19:15:08 572]  WARN [com.github.unidbg.linux.ARM64SyscallHandler] (ARM64SyscallHandler:410) - handleInterrupt <span class="hljs-attribute">intno</span>=2, <span class="hljs-attribute">NR</span>=-130448, <span class="hljs-attribute">svcNumber</span>=0x11e, <span class="hljs-attribute">PC</span>=unidbg@0xfffe0274, <span class="hljs-attribute">LR</span>=RX@0x1210d030[libmain.so]0x10d030, <span class="hljs-attribute">syscall</span>=<span class="hljs-literal">null</span><br>java.lang.UnsupportedOperationException: java/util/HashMap-&gt;<span class="hljs-built_in">get</span>(Ljava/lang/Object;)Ljava/lang/Object;<br>	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethod(AbstractJni.java:933)<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java/util/HashMap-&gt;get(Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>: &#123;<br>    <span class="hljs-type">HashMap</span> <span class="hljs-variable">hashMap</span> <span class="hljs-operator">=</span> (HashMap) dvmObject.getValue();<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">arg1</span> <span class="hljs-operator">=</span> varArg.getObjectArg(<span class="hljs-number">0</span>).getValue();<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> hashMap.get(arg1);<br>    <span class="hljs-keyword">return</span> vm.resolveClass(<span class="hljs-string">&quot;java/lang/Object&quot;</span>).newObject(result);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>补完之后，出现SecException报错</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">SecException</span>&#123;message: , errorCode: <span class="hljs-number">601</span>&#125;<br></code></pre></td></tr></table></figure>

<p>搜索发现是参数不正确。</p>
<p>后续待补充…..</p>
<hr>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://f5.pm/go-129256.html">unidbg调用sgmain的doCommandNative函数生成某酷encryptR_client参数</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-277006.htm">关于unidbg调试某app的libsgmainso文件出现的SecException(1910)问题-Android安全-看雪安全社区｜专业技术交流与安全研究论坛</a></p>
<p><a target="_blank" rel="noopener" href="https://f5.pm/go-129256.html">unidbg调用sgmain的doCommandNative函数生成某酷encryptR_client参数</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-268927-1.htm">[分享]9.23 mtop 6.5.27</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44084602/article/details/126923221">安卓逆向小案例——阿里系某电影票务APP加密参数还原-Unidbg篇_阿里系app逆向-CSDN博客</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Android%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98/" class="category-chain-item">Android逆向实战</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>某鱼App逆向</div>
      <div>http://example.com/2026/01/14/逆向实战/闲鱼App逆向/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>gla2xy</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2026年1月14日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2026/01/18/Triton/Triton%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E4%B8%8E%E4%BD%BF%E7%94%A8/" title="Triton源码编译与使用">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Triton源码编译与使用</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2026/01/11/Android%E5%AE%89%E5%85%A8/Binary%20Ninja%E5%85%A5%E9%97%A8/" title="Binary Ninja入门">
                        <span class="hidden-mobile">Binary Ninja入门</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.1/es5/tex-mml-chtml.js" ></script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
